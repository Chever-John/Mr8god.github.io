<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js ? id=UA-162074438-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-162074438-1');
</script>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"mr8god.cn","root":"/","scheme":"Muse","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Just learning！">
<meta property="og:type" content="website">
<meta property="og:title" content="Mr8god&#39;s blog">
<meta property="og:url" content="https://mr8god.cn/page/2/index.html">
<meta property="og:site_name" content="Mr8god&#39;s blog">
<meta property="og:description" content="Just learning！">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Mr8god">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://mr8god.cn/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Mr8god's blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-162074438-1# <app_id>"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-162074438-1# <app_id>');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Mr8god's blog" type="application/atom+xml"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>
<a href="https://github.com/Mr8god/Mr8god.github.io" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Mr8god's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">coding,coding,always coding!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mr8god.cn/2020/04/29/Java/Java%E6%97%A5%E8%AE%B0/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%97%A5%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mr8god">
      <meta itemprop="description" content="Just learning！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr8god's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/29/Java/Java%E6%97%A5%E8%AE%B0/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%97%A5%E8%AE%B0/" class="post-title-link" itemprop="url">Java多线程日记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-04-29 21:18:39 / 修改时间：00:36:35" itemprop="dateCreated datePublished" datetime="2020-04-29T21:18:39+08:00">2020-04-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Java多线程日记"><a href="#Java多线程日记" class="headerlink" title="Java多线程日记"></a>Java多线程日记</h1><p>目前应用“双十一”“12306”</p>
<p>三高：高可用、高性能、高并发</p>
<h2 id="线程简介"><a href="#线程简介" class="headerlink" title="线程简介"></a>线程简介</h2><p>现实中有很多例子，我们可以同时吃饭听歌，敲代码+听歌</p>
<p>但是很多看似是多任务，但是在一个时间点我们的大脑还是只做了一件事情</p>
<p>所以很多时候多线程是模拟的</p>
<p>真正的多任务是多核操作</p>
<h3 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h3><p>想象下现实中，三个电器接在同一个电线上，打开任何的电源，都能够同时亮起，同时工作 </p>
<p>同理，如果没有多线程的话，必须一个等一个先完成，再能去访问，就不能一起访问了</p>
<p><img src="https://i.loli.net/2020/04/29/DJ1bAlSLjfRqFpt.jpg" alt="有多线程和没有多线程之间的区别"></p>
<p><strong>解释</strong>：没有多线程的话，main只能一步一步慢慢走。有多线程的话，可以同时有两条路一起走。</p>
<h3 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h3><ul>
<li>线程就是独立的执行路径；</li>
<li>在程序运行时，即使没有自己创建线程，后台也会存在多个线程，如gc线程、主线程；</li>
<li>main()称之为主线程，为系统的入口点，用于执行整个程序；</li>
<li>在一个进程中，如果开辟了多个线程，线程的运行由调度器安排调度，调度器是与操作系统紧密相关的，先后顺序是不能人为的干预的；</li>
<li>对同一份资源操作时，会存在资源抢夺的问题，需要加入并发控制；</li>
<li>线程会带来额外的开销，如CPU调度时间，并发控制开销；</li>
<li>每个线程在自己的工作内存交互，加载和存储主内存控制不当会造成数据不一致。</li>
</ul>
<p>main()称之为主线程，微系统的入口点，用于执行整个程序。</p>
<h2 id="线程实现"><a href="#线程实现" class="headerlink" title="线程实现"></a>线程实现</h2><h2 id="线程状态"><a href="#线程状态" class="headerlink" title="线程状态"></a>线程状态</h2><h2 id="线程同步"><a href="#线程同步" class="headerlink" title="线程同步"></a>线程同步</h2><h2 id="生产消费者"><a href="#生产消费者" class="headerlink" title="生产消费者"></a>生产消费者</h2><h2 id="高级主题"><a href="#高级主题" class="headerlink" title="高级主题"></a>高级主题</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mr8god.cn/2020/04/29/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mr8god">
      <meta itemprop="description" content="Just learning！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr8god's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/29/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0/" class="post-title-link" itemprop="url">Java多线程日记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-04-29 11:18:39 / 修改时间：00:37:50" itemprop="dateCreated datePublished" datetime="2020-04-29T11:18:39+08:00">2020-04-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="数据库学习日记"><a href="#数据库学习日记" class="headerlink" title="数据库学习日记"></a>数据库学习日记</h1><h2 id="界面操作（单指SQLServerManagement）"><a href="#界面操作（单指SQLServerManagement）" class="headerlink" title="界面操作（单指SQLServerManagement）"></a>界面操作（单指SQLServerManagement）</h2><p>数据库：创建、删除、分离、附加、生成脚本（架构，数据）</p>
<p>表：创建、修改、删除</p>
<p>字段类型介绍：int、bit、datetime、decimal、char/varchar/nvarchar<br>带不带n：</p>
<ul>
<li>带n：表示Unicode编码，每个字符占一个字节</li>
<li>不带n：表示非Unicode编码，英文或数字占一个字节，中文占两个字节</li>
</ul>
<p>带不带var：举列子char(5)，要存入’abc’</p>
<ul>
<li>不带var：’abc<em> </em>‘    后边会有两个空格（固定式，不可变长度，会在末尾补空格，能用固定就用固定，比如说固定的电话号码长度，这样性能会更高）</li>
<li>带var：’abc’     后边不带空格（非固定式，可变长度，性能会低一点，但是对于一些长度不定的，比如说姓名，会有奇效）</li>
</ul>
<h2 id="利用SQL语句创建数据库"><a href="#利用SQL语句创建数据库" class="headerlink" title="利用SQL语句创建数据库"></a>利用SQL语句创建数据库</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> [<span class="keyword">database</span><span class="string">'s name]</span></span><br><span class="line"><span class="string">on primary</span></span><br><span class="line"><span class="string">                 (</span></span><br><span class="line"><span class="string">                 name = '</span>stuDB_data<span class="string">',</span></span><br><span class="line"><span class="string">                 filename = '</span>D:\stuDB_data.mdf<span class="string">',</span></span><br><span class="line"><span class="string">                 size = 5mb,</span></span><br><span class="line"><span class="string">                 maxsize = 100mb,</span></span><br><span class="line"><span class="string">                 filegrowth = 15%</span></span><br><span class="line"><span class="string">                 )</span></span><br><span class="line"><span class="string">                 </span></span><br><span class="line"><span class="string">log on</span></span><br><span class="line"><span class="string">                 (</span></span><br><span class="line"><span class="string">                 name = '</span>stuDB_logo<span class="string">',</span></span><br><span class="line"><span class="string">                 filename = '</span>D:\stuDB_logo.ldf<span class="string">',</span></span><br><span class="line"><span class="string">                 size = 2mb,</span></span><br><span class="line"><span class="string">                 maxsize = 1mb,</span></span><br><span class="line"><span class="string">                 filegrowth = 15%</span></span><br><span class="line"><span class="string">                 )</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> database_name </span><br><span class="line"><span class="keyword">ON</span>    </span><br><span class="line">&#123;  [ PRIMARY ]  </span><br><span class="line">				( </span><br><span class="line">                 	<span class="keyword">NAME</span> = logical_file_name ,    </span><br><span class="line">					FILENAME = ‘os_file_name’ </span><br><span class="line">					[ , <span class="keyword">SIZE</span> = <span class="keyword">size</span>]  </span><br><span class="line">					[ , <span class="keyword">MAXSIZE</span> = &#123; max_size | <span class="keyword">UNLIMITED</span> &#125; ] </span><br><span class="line">					[ , FILEGROWTH = growth_increment ])</span><br><span class="line">&#125; [ ,...n ] </span><br><span class="line"><span class="keyword">LOG</span> <span class="keyword">ON</span> </span><br><span class="line">&#123;  [ PRIMARY ]  ( </span><br><span class="line">    				<span class="keyword">NAME</span> = logical_file_name ,   </span><br><span class="line">					FILENAME = ‘os_file_name’ </span><br><span class="line">					[ , <span class="keyword">SIZE</span> = <span class="keyword">size</span>] 	</span><br><span class="line">					[ , <span class="keyword">MAXSIZE</span> = &#123; max_size | <span class="keyword">UNLIMITED</span> &#125; ] </span><br><span class="line">					[ , FILEGROWTH = growth_increment ])</span><br><span class="line">&#125; [ ,...n ]</span><br></pre></td></tr></table></figure>
<h2 id="利用SQL语句操作表"><a href="#利用SQL语句操作表" class="headerlink" title="利用SQL语句操作表"></a>利用SQL语句操作表</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mr8god.cn/2020/04/24/%E6%90%AD%E5%BB%BA%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E5%8F%B0%E7%BE%A4%E6%99%96%E6%9C%8D%E5%8A%A1%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mr8god">
      <meta itemprop="description" content="Just learning！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr8god's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/24/%E6%90%AD%E5%BB%BA%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E5%8F%B0%E7%BE%A4%E6%99%96%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="post-title-link" itemprop="url">搭建我的第一台群晖服务器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-04-24 00:13:25" itemprop="dateCreated datePublished" datetime="2020-04-24T00:13:25+08:00">2020-04-24</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="搭建我的第一台群晖服务器"><a href="#搭建我的第一台群晖服务器" class="headerlink" title="搭建我的第一台群晖服务器"></a>搭建我的第一台群晖服务器</h1><p>首先建造群晖专用系统盘</p>
<p>找一个U盘</p>
<h2 id="制作系统盘"><a href="#制作系统盘" class="headerlink" title="制作系统盘"></a>制作系统盘</h2><p>Step1：<br>使用DiskGenuis工具将U盘的所有分区都清除掉</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mr8god.cn/2020/04/22/Java/Java%E6%97%A5%E8%AE%B0/Java%E6%97%A5%E8%AE%B0%E2%80%94%E2%80%94%E5%85%B3%E4%BA%8EHashSet%E7%9A%84%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mr8god">
      <meta itemprop="description" content="Just learning！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr8god's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/22/Java/Java%E6%97%A5%E8%AE%B0/Java%E6%97%A5%E8%AE%B0%E2%80%94%E2%80%94%E5%85%B3%E4%BA%8EHashSet%E7%9A%84%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/" class="post-title-link" itemprop="url">Java日记——关于HashSet的源码剖析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-04-22 22:32:52 / 修改时间：23:44:20" itemprop="dateCreated datePublished" datetime="2020-04-22T22:32:52+08:00">2020-04-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Java日记——关于HashSet的源码剖析"><a href="#Java日记——关于HashSet的源码剖析" class="headerlink" title="Java日记——关于HashSet的源码剖析"></a>Java日记——关于HashSet的源码剖析</h1><h2 id="序言"><a href="#序言" class="headerlink" title="序言"></a>序言</h2><p>这个我随手整到的一个知识点，确实很值得深挖，我在这其中得到的知识点也远大于其本身，这一点知识让我明白了任何小知识都得深挖源码，收获太大了。</p>
<p>首先感谢一下带给我思路的知乎答者：<a href="https://www.zhihu.com/question/28414001" target="_blank" rel="noopener">https://www.zhihu.com/question/28414001</a></p>
<p>下面正式开始我的表演</p>
<h2 id="首先（看结果）"><a href="#首先（看结果）" class="headerlink" title="首先（看结果）"></a>首先（看结果）</h2><p>以一段代码开始</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mr8god.kchaptereleven;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/22</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 20:37</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SetOfInteger</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Random rnd = <span class="keyword">new</span> Random(<span class="number">47</span>);</span><br><span class="line">        Set&lt;Integer&gt; intset = <span class="keyword">new</span> HashSet&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++)&#123;</span><br><span class="line">            intset.add(rnd.nextInt(<span class="number">30</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(intset);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是一段平平无奇的，展示<strong>HashSet</strong>魅力的一段代码。代码的意思也很简单，就是让随机生成的0~29的数字存入我们的<strong>Set</strong>当中去。这里边随机了10000次，就意味着有很多很多重复的数字，当然我们大<strong>Set</strong>家族绝对不会包容两个一模一样的玩意儿，所以输出结果很是理想（单指这方面的理想），它就输出了这三十个数字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29]</span><br></pre></td></tr></table></figure>
<p>但是呢，结果却好像有点违背了我们所讲的“<strong>无序</strong>”，这明明是有顺序的一个一个排着输出的呀，啷个嘞就给我说成“<strong>无序</strong>”了呢？顺便展示一下概念</p>
<blockquote>
<p>HashSet：一种没有重复元素的无序集合</p>
</blockquote>
<p>我先来回答这个问题：我们一般所说的<strong>HashSet</strong>是无序的，但是它既不能保证存储和取出顺序一致， 更不能保证自然顺序一致（按照a-z）</p>
<p>顺道一提，我《Thinking in Java》书本中的输出是这样的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[15, 8, 23, 16, 7, 22, 9, 21, 6, 1 , 29 , 14, 24, 4, 19, 26, 11, 18, 3, 12, 27, 17, 2, 13, 28, 20, 25, 10, 5, 0]</span><br></pre></td></tr></table></figure>
<p>现在是不是就很奇妙了，为啥我同一段代码运行出来会是两个不同的结果，一个“<strong>有序</strong>”，一个“<strong>无序</strong>“。其实按照我江某人在C++中的经验来看，这很有可能就是语言版本的问题，这边很有可能就是<strong>JDK版本</strong>的问题，于是我们来分析源码验证我的思路</p>
<h2 id="然后（分析源码）"><a href="#然后（分析源码）" class="headerlink" title="然后（分析源码）"></a>然后（分析源码）</h2><p>我们首先从程序的第一步——集合元素的存储开始看起，先看<strong>HashSet</strong> 的 <strong>add</strong>方法的源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HashSet 源码节选-JKD8</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> map.put(e, PRESENT)==<span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到，<strong>HashSet</strong>直接调用的是<strong>HashMap</strong>的<strong>put</strong>方法，并且将元素<strong>e</strong>放到<strong>map</strong>的<strong>key</strong>位置（保证了唯一性）</p>
<p>顺着线索继续查看我们的<strong>HashMap</strong>的<strong>put</strong>方法源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//HashMap 源码节选-JDK8</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而我们的值在返回前需要经过<strong>HashMap</strong>中的<strong>hash</strong>方法</p>
<p>接着定位到<strong>hash</strong>方法的源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>hash</strong>方法的返回结果中是一句三目运算符，键（<strong>key</strong>）为<strong>null</strong>即返回0，存在则返回后一句的内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>)</span><br></pre></td></tr></table></figure>
<p>重点来了，这个东西叫做“<strong>扰动函数</strong>”</p>
<h3 id="这个时候断一下我们再来分析一下"><a href="#这个时候断一下我们再来分析一下" class="headerlink" title="这个时候断一下我们再来分析一下"></a>这个时候断一下我们再来分析一下</h3><p><strong>hashCode</strong>是<strong>Object</strong>类中的一个方法，在子类中一般会被重写，而根据我们之前自己给出的程序，暂以<strong>Integer</strong>类型为例，我们来看一下<strong>Integer</strong>中<strong>hashCode</strong>方法的源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a hash code for this &#123;<span class="doctag">@code</span> Integer&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>  a hash code value for this object, equal to the</span></span><br><span class="line"><span class="comment"> *          primitive &#123;<span class="doctag">@code</span> int&#125; value represented by this</span></span><br><span class="line"><span class="comment"> *          &#123;<span class="doctag">@code</span> Integer&#125; object.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Integer.hashCode(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a hash code for a &#123;<span class="doctag">@code</span> int&#125; value; compatible with</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> Integer.hashCode()&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value the value to hash</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> a hash code value for a &#123;<span class="doctag">@code</span> int&#125; value.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>果然，不出所料，这边真的重写<strong>hashCode</strong>了，<strong>Integer</strong>中<strong>hasCode</strong>方法的返回值就是这个数本身</p>
<p>注释：其实整数的值因为与整数本身一样唯一，所以它也是一个足够好的散列值呢</p>
<p>这上面得出的结论就是，下面的<strong>A式</strong>和<strong>B式</strong>是等价的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A：(h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>)</span><br><span class="line">B：key ^ (h &gt;&gt;&gt; <span class="number">16</span>)</span><br></pre></td></tr></table></figure>
<p>over，继续回归正途，接下来就是直接进行位运算层面了</p>
<h2 id="接着（转攻计算散列值——位运算开始了）"><a href="#接着（转攻计算散列值——位运算开始了）" class="headerlink" title="接着（转攻计算散列值——位运算开始了）"></a>接着（转攻计算散列值——位运算开始了）</h2><p>首先不急，先理清思路，这个时候</p>
<p><strong>HashSet</strong>因为底层使用了<strong>哈希表（链表结合数组）</strong>实现，存储<strong>key</strong>时可以通过一系列运算后得出自己在数组中所处的位置。</p>
<p>我们在<strong>hashCode</strong>方法中返回到了一个等同于本身值的散列值（证明过程如“然后（分析源码）”中的“这个时候断一下我们再来分析一下”可见）。</p>
<p>但是呢，考虑到<strong>int</strong>类型数据的范围：-2147483648~2147483647，很明显，这些散列值不能够直接使用，因为内存是没有办法放得下一个40亿长度的数组的。所以它使用了对数组长度进行<strong>取模运算</strong>的解决方法，得余后再作为其数组下标。</p>
<p>在<strong>JDK7</strong>中，这个被称为<strong>indexFor()</strong>的方法就是用来做这个的。<br>在<strong>JDK8</strong>中，就是一句代码，其实和<strong>JDK7</strong>的一样</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//JDK8中</span></span><br><span class="line">(tab.length - <span class="number">1</span>) &amp; hash；</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//JDK7中 </span></span><br><span class="line">bucketIndex = indexFor(hash, table.length);</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">indexFor</span><span class="params">(<span class="keyword">int</span> h, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> h &amp; (length - <span class="number">1</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>顺道加一句</strong>，为什么我们取模运算不用<strong>%</strong>而用<strong>&amp;</strong>呢？因为位运算直接对内存数据进行操作，不需要转成十进制，因此处理速度会非常快，这样就导致了位运算<strong>&amp;</strong>效率要比取模运算<strong>%</strong>高很多。</p>
<p>看到这边我们就知道了，存储时<strong>key</strong>的下标位置是需要通过<strong>hash</strong>方法和<strong>indexFor()</strong>或<strong>JDK8的类indexFor()</strong>运算得来的。</p>
<h3 id="正式开始我们的位运算（-amp-）"><a href="#正式开始我们的位运算（-amp-）" class="headerlink" title="正式开始我们的位运算（&amp;）"></a>正式开始我们的位运算（&amp;）</h3><p>我们开始举个例子了</p>
<p>HashMap中初始长度为16，length - 1 = 15；其二进制表示为 00000000 00000000 00000000 00001111</p>
<p>而与运算计算方式为：遇0则0，我们随便举一个<strong>key</strong>值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">	1111 1111 1010 0101 1111 0000 0011 1100 </span><br><span class="line">&amp; 	0000 0000 0000 0000 0000 0000 0000 1111 </span><br><span class="line">---------------------------------------------------- </span><br><span class="line">	0000 0000 0000 0000 0000 0000 0000 1100</span><br></pre></td></tr></table></figure>
<p>上面随便举的<strong>key</strong>值就是：1111 1111 1010 0101 1111 0000 0011 1100 </p>
<p>我们将这32位从中分开，左边16位称作高位，右边16位称作低位，可以看到经过&amp;运算后 结果就是高位全部归0，剩下了低位的最后四位。但是问题就来了，我们按照当前初始长度为默认的16，HashCode值为下图两个，可以看到，在不经过扰动计算时，只进行与(&amp;)运算后 Index值均为 12 这也就导致了哈希冲突</p>
<p><img src="https://i.loli.net/2020/04/22/HAvmCw7KOF6t3B1.jpg" alt="需要的.jpg"></p>
<blockquote>
<p>哈希冲突的简单理解：计划把一个对象插入到散列表（哈希表）中，但是发现这个位置已经被别人的对象给占据了</p>
</blockquote>
<p>例子中，两个不同的HashCode值却经过运算后，得到了相同的值，也就代表，他们都需要被放在下标为2的位置</p>
<p>一般来说，如果数据分布比较广泛，而且存储数据的数组长度比较大，那么哈希冲突就会比较少，否则很高。</p>
<p>但是，如果像上例中只取最后几位的时候，这可不是什么好事，即使我的数据分布很散乱，但是哈希冲突仍然会很严重。</p>
<p>别忘了，我们的扰动函数还在前面搁着呢，这个时候它就要发挥强大的作用了,还是使用上面两个发生了哈希冲突的数据，这一次我们加入扰动函数再进行与(&amp;)运算</p>
<p><img src="https://i.loli.net/2020/04/22/CPfnloXFEBtIJgA.jpg" alt="对哈希冲突的解决2.jpg"></p>
<blockquote>
<p>补充 ：&gt;&gt;&gt; 按位右移补零操作符，左操作数的值按右操作数指定的为主右移，移动得到的空位以零填充<br>^     位异或运算，相同则0，不同则1</p>
</blockquote>
<p>可以看到，本发生了哈希冲突的两组数据，经过扰动函数处理后，数值变得不再一样了，也就避免了冲突</p>
<p>其实在<strong>扰动函数</strong>中，将<strong>数据右位移16位</strong>，哈希码的<strong>高位和低位混合</strong>了起来，这也正解决了前面所讲 高位归0，计算只依赖低位最后几位的情况,  这使得高位的一些特征也<strong>对低位产生了影响</strong>，使得<strong>低位的随机性加强</strong>，能更好的<strong>避免冲突</strong></p>
<h2 id="再然后"><a href="#再然后" class="headerlink" title="再然后"></a>再然后</h2><p>到了这里，我们一步步研究到了这一些知识</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HashSet <span class="title">add</span><span class="params">()</span> → HashMap <span class="title">put</span><span class="params">()</span> → HashMap <span class="title">hash</span><span class="params">()</span> → <span class="title">HashMap</span> <span class="params">(tab.length - <span class="number">1</span>)</span> &amp; hash；</span></span><br></pre></td></tr></table></figure>
<p>有了这些知识的铺垫，我对于刚开始自己举的例子又产生了一些疑惑,我使用<strong>for循环</strong>添加一些整型元素进入集合，难道就没有任何一个发生哈希冲突吗，为什么遍历结果是有序输出的，经过简单计算 2 和18这两个值就都是2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;key &#x3D; 2,(length -1) &#x3D; 15 </span><br><span class="line"></span><br><span class="line">h &#x3D; key.hashCode() 	0000 0000 0000 0000 0000 0000 0000 0010 </span><br><span class="line">h &gt;&gt;&gt; 16 			0000 0000 0000 0000 0000 0000 0000 0000 </span><br><span class="line">hash &#x3D; h^(h &gt;&gt;&gt; 16) 0000 0000 0000 0000 0000 0000 0000 0010 </span><br><span class="line">(tab.length-1)&amp;hash 0000 0000 0000 0000 0000 0000 0000 1111 </span><br><span class="line">					0000 0000 0000 0000 0000 0000 0000 0010 </span><br><span class="line">------------------------------------------------------------- </span><br><span class="line">					0000 0000 0000 0000 0000 0000 0000 0010</span><br><span class="line">					</span><br><span class="line">&#x2F;&#x2F;2的十进制结果：2</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;key &#x3D; 18,(length -1) &#x3D; 15</span><br><span class="line"></span><br><span class="line">h &#x3D; key.hashCode() 	0000 0000 0000 0000 0000 0000 0001 0010 </span><br><span class="line">h &gt;&gt;&gt; 16 			0000 0000 0000 0000 0000 0000 0000 0000 </span><br><span class="line">hash &#x3D; h^(h &gt;&gt;&gt; 16) 0000 0000 0000 0000 0000 0000 0001 0010 </span><br><span class="line">(tab.length-1)&amp;hash 0000 0000 0000 0000 0000 0000 0000 1111 </span><br><span class="line">					0000 0000 0000 0000 0000 0000 0000 0010 </span><br><span class="line">------------------------------------------------------------- </span><br><span class="line">					0000 0000 0000 0000 0000 0000 0000 0010 </span><br><span class="line">		</span><br><span class="line">&#x2F;&#x2F;18的十进制结果：2</span><br></pre></td></tr></table></figure>
<p>按照我们上面的知识，按理应该输出 1 2 18 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 但却仍有序输出了</p>
<p>这就非常苦恼了，不过我发现了一个有趣的现象，当我的代码如下时</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mr8god.kchaptereleven;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/22</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 20:37</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SetOfInteger</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Random rnd = <span class="keyword">new</span> Random(<span class="number">47</span>);</span><br><span class="line">        Set&lt;Integer&gt; intset = <span class="keyword">new</span> HashSet&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)&#123;</span><br><span class="line">            intset.add(rnd.nextInt(<span class="number">30</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(intset);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[5, 8, 13]</span><br></pre></td></tr></table></figure>
<p>于是我将问题的核心转为了<strong>数组长度问题</strong>，这个就是最终的大Boss了</p>
<h2 id="最后（大Boss——数组长度）"><a href="#最后（大Boss——数组长度）" class="headerlink" title="最后（大Boss——数组长度）"></a>最后（大Boss——数组长度）</h2><p>继续找到<strong>HashMap</strong>源码，我发现了一个有趣的东西</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The maximum capacity, used if a higher value is implicitly specified</span></span><br><span class="line"><span class="comment"> * by either of the constructors with arguments.</span></span><br><span class="line"><span class="comment"> * MUST be a power of two &lt;= 1&lt;&lt;30.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The load factor used when none specified in constructor.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>&lt;&lt; ：按位左移运算符，做操作数按位左移右错作数指定的位数，即左边最高位丢弃，右边补齐0，计算的简便方法就是：把 &lt;&lt; 左面的数据乘以2的移动次幂<br>为什么初始长度为16：1 &lt;&lt; 4 即 1 * 2 ^4 =16; </p>
</blockquote>
<p>这里边有一个叫做<strong>加载因子</strong>的东西，他默认值为0.75f，这是什么意思呢，我们来补充一点它的知识：</p>
<blockquote>
<p>加载因子就是表示哈希表中元素填满的程度，当表中元素过多，超过加载因子的值时，哈希表会自动扩容，一般是一倍，这种行为可以称作rehashing(再哈希)。<br>加载因子的值设置的越大，添加的元素就会越多，确实空间利用率的到了很大的提升，但是毫无疑问，就面临着哈希冲突的可能性增大，反之，空间利用率造成了浪费，但哈希冲突也减少了，所以我们希望在空间利用率与哈希冲突之间找到一种我们所能接受的平衡，经过一些试验，定在了0.75f</p>
</blockquote>
<p>现在可以解决我们上面的疑惑了</p>
<p>数组初始的实际长度 = 16 * 0.75 = 12</p>
<p>这代表当我们元素数量增加到12以上时就会发生扩容，当我们上例中for循环添加0-18， 这19个元素时，先保存到前12个到第十三个元素时，超过加载因子，导致数组发生了一次扩容，而扩容以后对应与(&amp;)运算的(tab.length-1)就发生了变化,从16-1 变成了 32-1 即31</p>
<p>我们来算一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;key &#x3D; 2,(length -1) &#x3D; 31 </span><br><span class="line">h &#x3D; key.hashCode() 	0000 0000 0000 0000 0000 0000 0001 0010 </span><br><span class="line">h &gt;&gt;&gt; 16 			0000 0000 0000 0000 0000 0000 0000 0000 </span><br><span class="line">hash &#x3D; h^(h &gt;&gt;&gt; 16) 0000 0000 0000 0000 0000 0000 0001 0010 </span><br><span class="line">(tab.length-1)&amp;hash 0000 0000 0000 0000 0000 0000 0011 1111 </span><br><span class="line">					0000 0000 0000 0000 0000 0000 0000 0010 </span><br><span class="line">------------------------------------------------------------- </span><br><span class="line">					0000 0000 0000 0000 0000 0000 0000 0010 </span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;十进制结果：2</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;key &#x3D; 18,(length -1) &#x3D; 31 </span><br><span class="line">h &#x3D; key.hashCode() 	0000 0000 0000 0000 0000 0000 0001 0010 </span><br><span class="line">h &gt;&gt;&gt; 16 			0000 0000 0000 0000 0000 0000 0000 0000 </span><br><span class="line">hash &#x3D; h^(h &gt;&gt;&gt; 16) 0000 0000 0000 0000 0000 0000 0001 0010 </span><br><span class="line">(tab.length-1)&amp;hash 0000 0000 0000 0000 0000 0000 0011 1111 </span><br><span class="line">					0000 0000 0000 0000 0000 0000 0000 0010 </span><br><span class="line">------------------------------------------------------------- </span><br><span class="line">					0000 0000 0000 0000 0000 0000 0001 0010 </span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;十进制结果：18</span><br></pre></td></tr></table></figure>
<p>当length -  1 的值发生改变的时候，18的值也变成了本身。</p>
<p>到这里，才意识到自己之前用2和18计算时 均使用了 length -1 的值为 15是错误的，当时并不清楚<strong>加载因子及它的扩容机制</strong>，这才是导致提出有问题疑惑的根本原因。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><strong>JDK7</strong>到<strong>JDK8</strong>，其内部发生了一些变化，导致在不同版本<strong>JDK</strong>下运行结果不同，根据上面的分析，我们从<strong>HashSet</strong>追溯到<strong>HashMap</strong>的<strong>hash</strong>算法、加载因子和默认长度。</p>
<p>由于我们所创建的<strong>HashSet</strong>是<strong>Integer</strong>类型的，这也是最巧的一点，<strong>Integer</strong>类型<strong>hashCode()</strong>的返回值就是其<strong>int</strong>值本身，而存储的时候元素通过一些运算后会得出自己在数组中所处的位置。由于在这一步，其本身即下标(只考虑这一步)，其实已经实现了排序功能，由于<strong>int</strong>类型范围太广，内存放不下，所以对其进行取模运算，为了减少哈希冲突，又在取模前进行了，扰动函数的计算，得到的数作为元素下标，按照<strong>JDK8</strong>下的<strong>hash</strong>算法，以及<strong>load factor</strong>及扩容机制，这就导致数据在经过 <strong>HashMap.hash()</strong>运算后仍然是自己本身的值，且没有发生哈希冲突。</p>
<p><strong>补充</strong>：对于有序无序的理解</p>
<p>集合所说的序，是指元素存入集合的顺序，当元素存储顺序和取出顺序一致时就是有序，否则就是无序。 </p>
<p>并不是说存储数据的时候无序，没有规则，当我们不论使用<strong>for循环</strong>随机数添加元素的时候，还是<strong>for循环</strong>有序添加元素的时候，最后遍历输出的结果均为按照值的大小排序输出，随机添加元素，但结果仍有序输出，这就对照着上面那句，存储顺序和取出顺序是不一致的，所以我们说<strong>HashSet</strong>是无序的，虽然我们按照123的顺序添加元素，结果虽然仍为123，但这只是一种巧合而已。</p>
<p>所以<strong>HashSet</strong>只是<strong>不保证有序</strong>，并<strong>不是保证无序</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mr8god.cn/2020/04/20/Java/Java%E6%97%A5%E8%AE%B0/Java%E6%97%A5%E8%AE%B0%E2%80%94%E2%80%94%E6%8C%81%E6%9C%89%E5%AF%B9%E8%B1%A1%EF%BC%88%E5%B0%B1%E6%98%AF%E5%AE%B9%E5%99%A8%E5%95%A6%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mr8god">
      <meta itemprop="description" content="Just learning！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr8god's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/20/Java/Java%E6%97%A5%E8%AE%B0/Java%E6%97%A5%E8%AE%B0%E2%80%94%E2%80%94%E6%8C%81%E6%9C%89%E5%AF%B9%E8%B1%A1%EF%BC%88%E5%B0%B1%E6%98%AF%E5%AE%B9%E5%99%A8%E5%95%A6%EF%BC%89/" class="post-title-link" itemprop="url">Java日记——持有对象（就是容器啦）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-04-20 21:18:39" itemprop="dateCreated datePublished" datetime="2020-04-20T21:18:39+08:00">2020-04-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-22 08:48:38" itemprop="dateModified" datetime="2020-04-22T08:48:38+08:00">2020-04-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Java日记——持有对象（就是容器啦）"><a href="#Java日记——持有对象（就是容器啦）" class="headerlink" title="Java日记——持有对象（就是容器啦）"></a>Java日记——持有对象（就是容器啦）</h1><p>攒了两天，都在好好看容器类，Java的容器类还只是看了个大概哈，今天给大家带来我初学的Java容器中的<strong>迭代器</strong></p>
<h2 id="迭代器简介"><a href="#迭代器简介" class="headerlink" title="迭代器简介"></a>迭代器简介</h2><p>迭代器也是一种设计模式，广泛用于情景比如：不需要重写代码就可以应用于不同类型的容器，可能大家不太理解哈，我换句话简单来讲：比如我们原本使用<strong>List</strong>进行编码的，但是后来发现如果能够把相同的代码应用于<strong>Set</strong>，将会显得非常方便，此时我们应该怎么做呢？从头开始编写通用的代码？<strong>nonono</strong>，其实他们只是使用<strong>容器</strong>而已，并不会在乎容器的类型，那么如何才能不重写代码就可以应用于不同类型的容器呢？</p>
<p>在<strong>Java</strong>中迭代器就是<strong>Iterator</strong>这个东西。迭代器其实也是一个对象，它的工作就是遍历并选择序列中的对象，而客户端程序员不必知道或关心序列底层的结构，就可以使用序列了。</p>
<p>此外，迭代器通常被称为<strong>轻量级对象</strong>：创建它的代价小。因此，经常可见到对迭代器有些奇怪的限制，例如<strong>Java</strong>中的<strong>Iterator</strong>只能单向移动，这个<strong>Iterator</strong>只能用来：</p>
<ol>
<li>使用方法<strong>iterator()</strong>要求容器返回一个<strong>Iterator</strong>。<strong>Iterator</strong>将准备好返回序列的第一个元素。</li>
<li>使用<strong>next()</strong>获得序列中的下一个元素。</li>
<li>使用<strong>hasNext()</strong>检查序列中是否还有元素。</li>
<li>使用<strong>remove()</strong>将迭代器新近返回的元素删除。</li>
</ol>
<p>接下来会有代码展示</p>
<h3 id="代码展示（Iterator）"><a href="#代码展示（Iterator）" class="headerlink" title="代码展示（Iterator）"></a>代码展示（Iterator）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mr8god.kchaptereleven;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> typeinfo.pets.Pet;</span><br><span class="line"><span class="keyword">import</span> typeinfo.pets.Pets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/20</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 9:59</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleIteration</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Pet&gt; pets = Pets.arrayList(<span class="number">12</span>);</span><br><span class="line">        System.out.println(pets);</span><br><span class="line">        Iterator&lt;Pet&gt; it = pets.iterator();</span><br><span class="line">        <span class="keyword">while</span>(it.hasNext())&#123;</span><br><span class="line">            Pet p = it.next();</span><br><span class="line">            System.out.print(p.id() + <span class="string">":"</span> + p + <span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        <span class="keyword">for</span> (Pet p :</span><br><span class="line">                pets) &#123;</span><br><span class="line">            System.out.print(p.id() + <span class="string">":"</span> + p + <span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        it = pets.iterator();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)&#123;</span><br><span class="line">            it.next();</span><br><span class="line">            it.remove();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(pets);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码很简单，就一个点是之前没有遇到过的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Iterator&lt;Pet&gt; it = pets.iterator();</span><br></pre></td></tr></table></figure>
<p>这个就是使用<strong>Iterator</strong>来遍历了<strong>pets</strong>了，</p>
<p>之后我们就可以使用<strong>hasNext()</strong>或<strong>next()</strong>了</p>
<p>如果你只是向前遍历<strong>List</strong>， 并不打算修改<strong>List</strong>对象本身，那么你可以看到<strong>foreach</strong>语法会显得更加的简洁。</p>
<p><strong>Iterator</strong>还可以移除由<strong>next()</strong>产生的最后一个元素，这意味着在调用<strong>remove()</strong>之前必须先调用<strong>next()</strong>。同理，我之后的<strong>previous</strong>也是这么个理</p>
<p>接收对象容器并传递它，从而在每个对象上都执行操作，这种思想就是<strong>Iterator</strong>了，当然我感觉这正是<strong>Java</strong>的精髓。</p>
<h3 id="代码展示二（不必知晓容器的确切类型）"><a href="#代码展示二（不必知晓容器的确切类型）" class="headerlink" title="代码展示二（不必知晓容器的确切类型）"></a>代码展示二（不必知晓容器的确切类型）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mr8god.kchaptereleven;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> typeinfo.pets.Pet;</span><br><span class="line"><span class="keyword">import</span> typeinfo.pets.Pets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/20</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 10:41</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CrossContainterIteration</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">(Iterator&lt;Pet&gt; it)</span></span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (it.hasNext())&#123;</span><br><span class="line">            Pet p = it.next();</span><br><span class="line">            System.out.print(p.id() + <span class="string">":"</span> + p + <span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ArrayList&lt;Pet&gt; pets = Pets.arrayList(<span class="number">8</span>);</span><br><span class="line">        LinkedList&lt;Pet&gt; petsLL = <span class="keyword">new</span> LinkedList&lt;Pet&gt;(pets);</span><br><span class="line">        HashSet&lt;Pet&gt; petsHs = <span class="keyword">new</span> HashSet&lt;Pet&gt;(pets);</span><br><span class="line">        TreeSet&lt;Pet&gt; petsTs = <span class="keyword">new</span> TreeSet&lt;Pet&gt;(pets);</span><br><span class="line">        display(pets.iterator());</span><br><span class="line">        display(petsLL.iterator());</span><br><span class="line">        display(petsHs.iterator());</span><br><span class="line">        display(petsTs.iterator());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里边的<strong>display()</strong>方法不包含任何有关它所遍历的序列的类型信息，</p>
<p>这正展示了<strong>Iterator</strong> 的真正威力：能够将遍历序列的操作与序列底层的结构分离。</p>
<p>正由于此，我们有时会说：迭代器统一了对容器的访问方式。</p>
<h2 id="异军突起——ListIterator"><a href="#异军突起——ListIterator" class="headerlink" title="异军突起——ListIterator"></a>异军突起——ListIterator</h2><p><strong>ListIterator</strong>是一个更加强大的<strong>Iterator</strong> 的子类型，它只能用于各种<strong>List</strong>类的访问。尽管<strong>Iterator</strong>只能向前移动，但是<strong>ListIterator</strong>可以双向移动。</p>
<p><strong>ListIterator</strong>还可以产生相对于迭代器在列表中指向的当前位置的前一个和后一个元素的索引，并且可以使用<strong>set()</strong>方法替换它访问过的最后一个元素。</p>
<p>你可以通过调用<strong>listIterator(n)</strong>方法产生一个指向<strong>List</strong>开始处的<strong>ListIterator</strong>， 并且还可以通过调用<strong>listIterator(n)</strong>方法创建一个一开始就指向列表索引为<strong>n</strong>的元素处的<strong>ListIterator</strong>。</p>
<h3 id="代码展示（ListIterator）"><a href="#代码展示（ListIterator）" class="headerlink" title="代码展示（ListIterator）"></a>代码展示（ListIterator）</h3><p>下面举代码展示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mr8god.kchaptereleven;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> typeinfo.pets.Pet;</span><br><span class="line"><span class="keyword">import</span> typeinfo.pets.Pets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.ListIterator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/20</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 20:11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListIteration</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Pet&gt; pets = Pets.arrayList(<span class="number">8</span>);</span><br><span class="line">        ListIterator&lt;Pet&gt; it = pets.listIterator();</span><br><span class="line">        <span class="keyword">while</span> (it.hasNext())&#123;</span><br><span class="line">            System.out.print(it.next() + <span class="string">", "</span> + it.nextIndex() + <span class="string">", "</span> + it.previousIndex() + <span class="string">"; "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        <span class="keyword">while</span> (it.hasPrevious())&#123;</span><br><span class="line">            System.out.print(it.previous().id() + <span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(pets);</span><br><span class="line">        it = pets.listIterator(<span class="number">3</span>);</span><br><span class="line">        <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">            it.next();</span><br><span class="line">            it.set(Pets.randomPet());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(pets );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="代码展示（自个写的倒序）"><a href="#代码展示（自个写的倒序）" class="headerlink" title="代码展示（自个写的倒序）"></a>代码展示（自个写的倒序）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mr8god.kchaptereleven.self;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.ListIterator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/21</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 21:51</span></span><br><span class="line"><span class="comment"> * 这个代码是《Java编程思想》第十一章持有对象的练习12（3）：</span></span><br><span class="line"><span class="comment"> * 创建并组装一个List,然后再创建第二个具有相同尺寸的List，</span></span><br><span class="line"><span class="comment"> * 将第一个List列表反序插入第二个列表中</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 这里边我的思路是首先用hasNext将LsIterator的指针滑到了容器的最后的位置</span></span><br><span class="line"><span class="comment"> * 然后我再使用previous，一步步，慢慢的往前滑，顺便赋值给int2</span></span><br><span class="line"><span class="comment"> * 其实我大可不必这么复杂，还调用previous，直接for倒序赋值就完事了</span></span><br><span class="line"><span class="comment"> * 但是这么一来我对previous的理解深入了，确实，这段代码中如果没有hasNext的话</span></span><br><span class="line"><span class="comment"> * previous是无法运行的，会报错，会爆越界，确实，我指针指在了第一个，</span></span><br><span class="line"><span class="comment"> * 我还要赋值，拿什么给他赋值呀，over，收获良多</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExerciseTwelve</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; int1 = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">10</span>);</span><br><span class="line">        List&lt;Integer&gt; int2 = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">            int1.add(i);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        System.out.println(int1);</span></span><br><span class="line">        <span class="keyword">int</span> counter = <span class="number">0</span>;</span><br><span class="line">        ListIterator&lt;Integer&gt; lulala = int1.listIterator();</span><br><span class="line">        <span class="keyword">while</span> (lulala.hasNext()) &#123;</span><br><span class="line">            System.out.print(lulala.next() + <span class="string">"("</span> + counter++ + <span class="string">") , "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">            int2.add(lulala.previous());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(int2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>网上的例子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mr8god.kchaptereleven.self;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.ListIterator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/21</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 22:28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExerciseTwelveTwolist</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> length;</span><br><span class="line">    List&lt;Integer&gt; list1 = <span class="keyword">new</span> ArrayList&lt;Integer&gt;(length);</span><br><span class="line">    List&lt;Integer&gt; list2 = <span class="keyword">new</span> ArrayList&lt;Integer&gt;(length);</span><br><span class="line">    ListIterator&lt;Integer&gt; li;</span><br><span class="line">    <span class="comment">// 构造函数，给list1赋值，并且将li指向list1的最末尾的一个元素</span></span><br><span class="line">     ExerciseTwelveTwolist(<span class="keyword">int</span> length)&#123;</span><br><span class="line">        <span class="keyword">this</span>.length = length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; length; i++)&#123;</span><br><span class="line">            list1.add(i);</span><br><span class="line">        &#125;</span><br><span class="line">        li = list1.listIterator(length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 对list2进行初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">list2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (li.hasPrevious())&#123;</span><br><span class="line">            <span class="comment">// 当ListIterator li前面具有元素时，将当前的元素</span></span><br><span class="line">            <span class="comment">// 赋值给list2，并且向前移动（即li.previous的功能）</span></span><br><span class="line">            list2.add(li.previous());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">out1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(list1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">out2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(list2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">            ExerciseTwelveTwolist ett = <span class="keyword">new</span> ExerciseTwelveTwolist(<span class="number">10</span>);</span><br><span class="line">            ett.list2();</span><br><span class="line">            ett.out1();</span><br><span class="line">            ett.out2();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再附上作者的一些感悟，over</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">网上查询到其他解决办法，其中通过while(li.hasnext())&#123;li1.next（）;&#125;将li指向list1的末尾，并且对于list2列表的操作也使用了ListIterator（对于后者，我觉得没有必要，此题中对list2本身就应该是一个空的list，对于它的操作仅仅是通过add()方法就可以了，没必要再创建一个listIterator）。感想：最初想通过直接对list进行操作，发现并不可行，list列表只有add（），get（）等方法，事实上是很难做到对其进行类似指针移动的操作，所以日后对于每一个需要操作的list数组进行一些操作，可能都需要用到ListIterator，或者简单的Iterator。在这里也不难理解为什么在这道题中的其它解决方法里，有人会对list2也使用一个listIterator,毕竟对list2也要进行一些操作（尽管这里只需要添加元素就好了）。在编写代码的时候，我总是会想直接把ListIterator直接赋值给List列表，类似于list1&#x3D;li。事实上，这样是行不通的，List列表和迭代器ListIterator之间的关系不存在继承，仅仅是迭代器ListIterator 对Collection进行操作而已。实现赋值则是使用List的add（）方法，调用迭代器Iterator的next（）方法，传入list。（本题中使用的是list2.add(li.previous());）此外，listIterator比iterator更为强大，它可以实现双向移动，也可以直接指向某个具体的元素，而iterator则只能单向移动。最后：思考良久，决定还是不将我的博客设置为私密好了，有人能看必定是好事，发现其中错误更是可喜可贺，本人也是大三学生一枚，想记录一些自己学习过程中的问题，解决方法等，同时也想着，或许能被大神看到？对我一些遗漏之类的进行补充？那自然也能学习到不少</span><br><span class="line">————————————————</span><br><span class="line">版权声明：本文为CSDN博主「qq_41791653」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。</span><br><span class="line">原文链接：https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_41791653&#x2F;article&#x2F;details&#x2F;80004740</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mr8god.cn/2020/04/18/Java/Java%E6%97%A5%E8%AE%B0/Java%E6%97%A5%E8%AE%B0%E2%80%94%E2%80%94%E6%8E%A5%E5%8F%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mr8god">
      <meta itemprop="description" content="Just learning！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr8god's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/18/Java/Java%E6%97%A5%E8%AE%B0/Java%E6%97%A5%E8%AE%B0%E2%80%94%E2%80%94%E6%8E%A5%E5%8F%A3/" class="post-title-link" itemprop="url">Java日记——接口</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-04-18 00:29:18 / 修改时间：00:56:39" itemprop="dateCreated datePublished" datetime="2020-04-18T00:29:18+08:00">2020-04-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h1><h2 id="9-3-完全解耦"><a href="#9-3-完全解耦" class="headerlink" title="9.3 完全解耦"></a>9.3 完全解耦</h2><p>假设我们有一组电子滤波器，它们适用于<strong>Apply.process()</strong>方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Apply.process()方法</span></span><br><span class="line"><span class="keyword">package</span> cn.mr8god.chapternine.interfaceprocessor;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> net.mindview.util.Print.print;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Apply</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(Processor p, Object s)</span> </span>&#123;</span><br><span class="line">        print(<span class="string">"Using Processor "</span> + p.name() );</span><br><span class="line">        print(p.process(s));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="电子滤波器代码包在下边"><a href="#电子滤波器代码包在下边" class="headerlink" title="电子滤波器代码包在下边"></a>电子滤波器代码包在下边</h3><h4 id="第一版"><a href="#第一版" class="headerlink" title="第一版"></a>第一版</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Waveform</span></span><br><span class="line"><span class="keyword">package</span> cn.mr8god.chapternine.filters;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/17</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 23:16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Waveform</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> counter;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id = counter++;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Waveform&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Filter</span></span><br><span class="line"><span class="keyword">package</span> cn.mr8god.chapternine.filters;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/17</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 23:17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">name</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getClass().getSimpleName();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Waveform <span class="title">process</span><span class="params">(Waveform input)</span></span>&#123; <span class="keyword">return</span> input; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LowPass</span></span><br><span class="line"><span class="keyword">package</span> cn.mr8god.chapternine.filters;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/17</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 23:19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LowPass</span> <span class="keyword">extends</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> cutoff;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LowPass</span><span class="params">(<span class="keyword">double</span> cutoff)</span></span>&#123; <span class="keyword">this</span>.cutoff = cutoff; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Waveform <span class="title">process</span><span class="params">(Waveform input)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> input;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HighPass</span></span><br><span class="line"><span class="keyword">package</span> cn.mr8god.chapternine.filters;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/17</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 23:20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HighPass</span> <span class="keyword">extends</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> cutoff;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HighPass</span><span class="params">(<span class="keyword">double</span> cutoff)</span></span>&#123; <span class="keyword">this</span>.cutoff = cutoff; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Waveform <span class="title">process</span> <span class="params">(Waveform input)</span></span>&#123; <span class="keyword">return</span> input; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BandPass</span></span><br><span class="line"><span class="keyword">package</span> cn.mr8god.chapternine.filters;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/17</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 23:22</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BandPass</span> <span class="keyword">extends</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> lowCutoff, highCutoff;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BandPass</span><span class="params">(<span class="keyword">double</span> lowCut, <span class="keyword">double</span> highCut)</span></span>&#123;</span><br><span class="line">        lowCutoff = lowCut;</span><br><span class="line">        highCutoff = highCut;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Waveform <span class="title">process</span><span class="params">(Waveform input)</span> </span>&#123; <span class="keyword">return</span> input; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>虽然<strong>Filter</strong>和<strong>Processor</strong>（代码我贴在这段话下面）具有相同的接口元素（且它们俩输出都是<strong>Waveform</strong>），但是因为<strong>Filter</strong>并非继承自<strong>Processor</strong>因此咱不能将<strong>Filter</strong>用于<strong>Apply.process()</strong>方法，即便这样做可以正常运行。</p>
<p>出现这个问题就是因为<strong>Apply.process()</strong>方法和<strong>Processor</strong>之间的耦合度太高了，已经超出所需要的程度了，这就使得应该复用<strong>Apply.process()</strong>的代码的时候，复用却被禁止了。</p>
<h4 id="第二段改良版本"><a href="#第二段改良版本" class="headerlink" title="第二段改良版本"></a>第二段改良版本</h4><p><u>但是如果<strong>Processor</strong>是一个接口，那么这些限制就谈不上限制了，使得你可以复用<strong>Apply.process()</strong>的代码了。</u></p>
<p>上代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这就是被写成接口的Processor</span></span><br><span class="line"><span class="keyword">package</span> cn.mr8god.chapternine.interfaceprocessor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/17</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 23:29</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Processor</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">Object <span class="title">process</span><span class="params">(Object input)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Apply</span></span><br><span class="line"><span class="keyword">package</span> cn.mr8god.chapternine.interfaceprocessor;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> net.mindview.util.Print.print;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Apply</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(Processor p, Object s)</span> </span>&#123;</span><br><span class="line">        print(<span class="string">"Using Processor "</span> + p.name() );</span><br><span class="line">        print(p.process(s));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>复用代码的<strong>第一种方式</strong>是客户端程序员遵循制定好的接口来编写自己的类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mr8god.chapternine.interfaceprocessor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/17</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 23:43</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">StringProcessor</span> <span class="keyword">implements</span> <span class="title">Processor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">name</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getClass().getSimpleName();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">process</span><span class="params">(Object input)</span></span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String s = <span class="string">"If she weighs the same as a duck, she's made of wood"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Apply.process(<span class="keyword">new</span> Upcase(), s);</span><br><span class="line">        Apply.process(<span class="keyword">new</span> Downcase(), s);</span><br><span class="line">        Apply.process(<span class="keyword">new</span> Splitter(), s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Upcase</span> <span class="keyword">extends</span> <span class="title">StringProcessor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">process</span><span class="params">(Object input)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ((String) input).toUpperCase();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Downcase</span> <span class="keyword">extends</span> <span class="title">StringProcessor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">process</span><span class="params">(Object input)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ((String) input).toLowerCase();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Splitter</span> <span class="keyword">extends</span> <span class="title">StringProcessor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">process</span><span class="params">(Object input)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.toString(((String)input).split(<span class="string">" "</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="第三段改良版本"><a href="#第三段改良版本" class="headerlink" title="第三段改良版本"></a>第三段改良版本</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// processor的接口</span></span><br><span class="line"><span class="keyword">package</span> cn.mr8god.chapternine.interfaceprocessor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/17</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 23:29</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Processor</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">Object <span class="title">process</span><span class="params">(Object input)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Apply的类</span></span><br><span class="line"><span class="keyword">package</span> cn.mr8god.chapternine.interfaceprocessor;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> net.mindview.util.Print.print;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Apply</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(Processor p, Object s)</span> </span>&#123;</span><br><span class="line">        print(<span class="string">"Using Processor "</span> + p.name() );</span><br><span class="line">        print(p.process(s));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mr8god.chapternine.interfaceprocessor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.mr8god.chapternine.filters.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FilterAdapter</span> <span class="keyword">implements</span> <span class="title">Processor</span> </span>&#123;</span><br><span class="line">    Filter filter;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FilterAdapter</span><span class="params">(Filter filter)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.filter = filter;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">name</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> filter.name();&#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Waveform <span class="title">process</span><span class="params">(Object input)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> filter.process((Waveform)input);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/17</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 23:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FilterProcessor</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Waveform w = <span class="keyword">new</span> Waveform();</span><br><span class="line">        Apply.process(<span class="keyword">new</span> FilterAdapter(<span class="keyword">new</span> LowPass(<span class="number">1.0</span>)), w);</span><br><span class="line">        Apply.process(<span class="keyword">new</span> FilterAdapter(<span class="keyword">new</span> HighPass(<span class="number">2.0</span>)), w);</span><br><span class="line">        Apply.process(<span class="keyword">new</span> FilterAdapter(<span class="keyword">new</span> BandPass(<span class="number">3.0</span>, <span class="number">4.0</span>)), w);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>说一下这一次改良的目的为何，在电子滤波器这个例子中，类库是被发现而非被创建的。在这些情况下，可以使用<strong>适配器设计模式</strong>。适配器中的代码将接受你所拥有的接口，并产生你所需要的接口。相当于做了一个二道贩子。</p>
<p>此外这种方法，<strong>FilterAdapter</strong>的构造器接受你所拥有的接口<strong>Filter</strong>，然后生成具有你所需要的<strong>Processor</strong>接口的对象。</p>
<p>哦对了，这里边的<strong>FilterAdapter</strong>还用到了<strong>代理</strong>（第七章复用类里边的，是一种介于继承和组合之间的思想）</p>
<p>将接口从具体实现中<strong>解耦</strong>使得接口可以应用于多种不同的具体实现，因此代码也就更具可复用性。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mr8god.cn/2020/04/16/Java/Java%E6%97%A5%E8%AE%B0/Java%E6%97%A5%E8%AE%B0%E2%80%94%E2%80%94%E5%A4%9A%E6%80%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mr8god">
      <meta itemprop="description" content="Just learning！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr8god's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/16/Java/Java%E6%97%A5%E8%AE%B0/Java%E6%97%A5%E8%AE%B0%E2%80%94%E2%80%94%E5%A4%9A%E6%80%81/" class="post-title-link" itemprop="url">Java日记——多态</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-04-16 22:14:05" itemprop="dateCreated datePublished" datetime="2020-04-16T22:14:05+08:00">2020-04-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-17 15:02:52" itemprop="dateModified" datetime="2020-04-17T15:02:52+08:00">2020-04-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h1><h2 id="8-3-1-构造器与多态之构造器的创建顺序"><a href="#8-3-1-构造器与多态之构造器的创建顺序" class="headerlink" title="8.3.1 构造器与多态之构造器的创建顺序"></a>8.3.1 构造器与多态之构造器的创建顺序</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mr8god.chaptereight;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> net.mindview.util.Print.print;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/16</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 20:15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meal</span></span>&#123;</span><br><span class="line">    Meal()&#123; print(<span class="string">"Meal()"</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bread</span></span>&#123;</span><br><span class="line">    Bread()&#123; print(<span class="string">"Bread()"</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cheese</span></span>&#123;</span><br><span class="line">    Cheese()&#123; print(<span class="string">"Cheese()"</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lettuce</span></span>&#123;</span><br><span class="line">    Lettuce()&#123; print(<span class="string">"Lettuce()"</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lunch</span> <span class="keyword">extends</span> <span class="title">Meal</span></span>&#123;</span><br><span class="line">    Lunch()&#123; print(<span class="string">"Lunch()"</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PortableLunch</span> <span class="keyword">extends</span> <span class="title">Lunch</span></span>&#123;</span><br><span class="line">    PortableLunch()&#123; print(<span class="string">"PortableLunch()"</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sandwich</span> <span class="keyword">extends</span> <span class="title">PortableLunch</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Bread b = <span class="keyword">new</span> Bread();</span><br><span class="line">    <span class="keyword">private</span> Cheese c = <span class="keyword">new</span> Cheese();</span><br><span class="line">    <span class="keyword">private</span> Lettuce l = <span class="keyword">new</span> Lettuce();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Sandwich</span><span class="params">()</span></span>&#123; print(<span class="string">"Sandwich()"</span>);&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Sandwich();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 输出结果</span><br><span class="line">Meal()</span><br><span class="line">Lunch()</span><br><span class="line">PortableLunch()</span><br><span class="line">Bread()</span><br><span class="line">Cheese()</span><br><span class="line">Lettuce()</span><br><span class="line">Sandwich()</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2020/04/16/MsXKb6vqhkrA2ax.png" alt="理解组合继承的构建顺序.png"></p>
<p>快速做了个图来理解这个东西哈！这里边每个类都有自己的<strong>构造方法</strong>，</p>
<p>其中最值得关注的就是<strong>Sandwich</strong>类，三个继承关系，（若将<strong>Object</strong>的根继承算上的话，那就是四层继承了）。其中还包括了三个成员对象。当我们在<strong>main()</strong>里边创建好一个<strong>Sandwich</strong>对象后，就可以看到输出结果了</p>
<h3 id="三条规则"><a href="#三条规则" class="headerlink" title="三条规则"></a>三条规则</h3><p>我先说一下复杂对象调用构造器要遵循的<strong>三条规则</strong>吧</p>
<ol>
<li>调用基类构造器。这个步骤会不断地反复递归下去，首先是构造这种层次结构的根，然后是下一层导出类，etc，直到最低层的导出类。</li>
<li>按声明顺序调用成员的初始化方法。</li>
<li>调用导出类构造器的主体。</li>
</ol>
<p>根据输出结果我们可以看到，它首先输出的就是Meal了，为什么会这样呢？因为根据我<strong>main()</strong>函数里定义的四个东西（三个成员对象和一个成员构造函数）来看我的输出应该是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 输出结果</span><br><span class="line">Bread()</span><br><span class="line">Cheese()</span><br><span class="line">Lettuce()</span><br><span class="line">Sandwich()</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>
<p>才对呀。很正常的思维，哈哈哈。不过呢，出现前两个，其实是为了表明，<strong>Meal</strong>类和<strong>Lunch</strong>类在之前先执行了自己的构造函数，而且又因为<strong>Meal</strong>类是<strong>Lunch</strong>类的基类（父类），所以<strong>Meal</strong>类的构造函数在更前面进行了构造了，这正好说明了我之前所说的<strong>三条规则</strong>中的第一条。</p>
<p>接下来我们输出的就是三小只了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Bread()</span><br><span class="line">Cheese()</span><br><span class="line">Lettuce()</span><br></pre></td></tr></table></figure>
<p>这符合我们之前说的，按照声明调用<strong>成员**</strong>成员**的初始化方法进行输出了</p>
<p>最后就是我们的导出类构造器的主体，与之对应的就是我们<strong>输出结果</strong>中的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Sandwich()</span><br></pre></td></tr></table></figure>
<h3 id="说说心里话"><a href="#说说心里话" class="headerlink" title="说说心里话"></a>说说心里话</h3><p>为什么我们的构造器调用顺序很重要，以至于我专门做了个笔记来讲它呢？</p>
<p>我们知道当我们导出类（子类）在进行继承的时候，我们是<strong>已经知道了基类（父类）的一切</strong>了，知道它的底细是怎样的呢！不然我们谈何继承呀，只要基类中标注为<strong>protected</strong>和<strong>public</strong>的，都是知道的，这就意味着我们在导出类中，必须假定所有成员<strong>都是有效的</strong>。</p>
<p>综上所述，我们要确保所有的成员都是有效的，就得从根基做好，先打牢根基，才能走得更远（很像咱们的编程语言学习哦！）。于是我们先启动基类的构造器，确保基类是完好无损的。然后依次向下。</p>
<p>此外，知道构造器中的所有成员有效也是因为成员对象在类内进行定义的时候，只要有可能，就应该对它们进行初始化。</p>
<h2 id="8-3-2-继承与清理"><a href="#8-3-2-继承与清理" class="headerlink" title="8.3.2 继承与清理"></a>8.3.2 继承与清理</h2><p>平常我们都是不需要注意清理的问题的，因为毕竟有我们的垃圾处理机制嘛。如果确实遇到了清理的问题，那么就得有心创建<strong>清理方法</strong>了。并且由于是继承的缘故。如果我们有其他作为垃圾回收一部分的特殊清理动作，就必须在导出类中覆盖该<strong>清理方法</strong>。<u>当覆盖被继承类的<strong>清理方法</strong>的时候，务必调用基类版本的<strong>清理方法</strong>，否则，基类的清理就不会发生。</u></p>
<p>上示范代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mr8god.chaptereight;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> net.mindview.util.Print.print;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Characteristic</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String s;</span><br><span class="line">    Characteristic(String s)&#123;</span><br><span class="line">        <span class="keyword">this</span>.s = s;</span><br><span class="line">        print(<span class="string">"Creating Characteristic "</span> + s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispose</span><span class="params">()</span></span>&#123;</span><br><span class="line">        print(<span class="string">"disposing Characteristic "</span> + s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Description</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String s;</span><br><span class="line">    Description(String s)&#123;</span><br><span class="line">        <span class="keyword">this</span>.s = s;</span><br><span class="line">        print(<span class="string">"Creating Description "</span> + s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispose</span><span class="params">()</span></span>&#123;</span><br><span class="line">        print(<span class="string">"disposing Description "</span> + s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LivingCreature</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Characteristic p =</span><br><span class="line">            <span class="keyword">new</span> Characteristic(<span class="string">"is alive"</span>);</span><br><span class="line">    <span class="keyword">private</span> Description t =</span><br><span class="line">            <span class="keyword">new</span> Description(<span class="string">"Basic Living Creature"</span>);</span><br><span class="line">    LivingCreature()&#123;</span><br><span class="line">        print(<span class="string">"LivingCreature()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispose</span><span class="params">()</span></span>&#123;</span><br><span class="line">        print(<span class="string">"LivingCreature dispose"</span>);</span><br><span class="line">        t.dispose();</span><br><span class="line">        p.dispose();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> <span class="keyword">extends</span> <span class="title">LivingCreature</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Characteristic p =</span><br><span class="line">            <span class="keyword">new</span> Characteristic(<span class="string">"has heart"</span>);</span><br><span class="line">    <span class="keyword">private</span> Description t =</span><br><span class="line">            <span class="keyword">new</span> Description(<span class="string">"Animal not Vegetable"</span>);</span><br><span class="line">    Animal()&#123; print(<span class="string">"Animal()"</span>);&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispose</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        print(<span class="string">"Animal dispose"</span>);</span><br><span class="line">        t.dispose();</span><br><span class="line">        p.dispose();</span><br><span class="line">        <span class="keyword">super</span>.dispose();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Amphibian</span> <span class="keyword">extends</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Characteristic p =</span><br><span class="line">            <span class="keyword">new</span> Characteristic(<span class="string">"can live in water"</span>);</span><br><span class="line">    <span class="keyword">private</span>  Description t =</span><br><span class="line">            <span class="keyword">new</span> Description(<span class="string">"Both water and land"</span>);</span><br><span class="line">    Amphibian()&#123;</span><br><span class="line">        print(<span class="string">"Amphibian"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispose</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        print(<span class="string">"Amphibian dispose"</span>);</span><br><span class="line">        t.dispose();</span><br><span class="line">        p.dispose();</span><br><span class="line">        <span class="keyword">super</span>.dispose();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/16</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 11:19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Frog</span> <span class="keyword">extends</span> <span class="title">Amphibian</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Characteristic p = <span class="keyword">new</span> Characteristic(<span class="string">"Croaks"</span>);</span><br><span class="line">    <span class="keyword">private</span> Description t = <span class="keyword">new</span> Description(<span class="string">"Eats Bugs"</span>);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Frog</span><span class="params">()</span> </span>&#123; print(<span class="string">"Frog()"</span>);&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispose</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        print(<span class="string">"Frog dispose"</span>);</span><br><span class="line">        t.dispose();</span><br><span class="line">        p.dispose();</span><br><span class="line">        <span class="keyword">super</span>.dispose();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Frog frog = <span class="keyword">new</span> Frog();</span><br><span class="line">        print(<span class="string">"Bye!"</span>);</span><br><span class="line">        frog.dispose();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 输出结果</span><br><span class="line">Creating Characteristic is alive</span><br><span class="line">Creating Description Basic Living Creature</span><br><span class="line">LivingCreature()</span><br><span class="line">Creating Characteristic has heart</span><br><span class="line">Creating Description Animal not Vegetable</span><br><span class="line">Animal()</span><br><span class="line">Creating Characteristic can live in water</span><br><span class="line">Creating Description Both water and land</span><br><span class="line">Amphibian</span><br><span class="line">Creating Characteristic Croaks</span><br><span class="line">Creating Description Eats Bugs</span><br><span class="line">Frog()</span><br><span class="line">Bye!</span><br><span class="line">Frog dispose</span><br><span class="line">disposing Description Eats Bugs</span><br><span class="line">disposing Characteristic Croaks</span><br><span class="line">Amphibian dispose</span><br><span class="line">disposing Description Both water and land</span><br><span class="line">disposing Characteristic can live in water</span><br><span class="line">Animal dispose</span><br><span class="line">disposing Description Animal not Vegetable</span><br><span class="line">disposing Characteristic has heart</span><br><span class="line">LivingCreature dispose</span><br><span class="line">disposing Description Basic Living Creature</span><br><span class="line">disposing Characteristic is alive</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2020/04/16/QzUjJZ2p9VoBC5L.png" alt="理解继承与清理.png"></p>
<p>代码太长，给大家整理了一个<strong>UML类图</strong>，其中<strong>dispose()</strong>就是我用来清理的方法。</p>
<p>然后呢，我们每个类都包括了<strong>Characteristic</strong>和<strong>Description</strong>这两种类型的成员对象，并且它们必须最终被<strong>销毁</strong>。</p>
<h3 id="什么是销毁顺序"><a href="#什么是销毁顺序" class="headerlink" title="什么是销毁顺序"></a>什么是销毁顺序</h3><p>谈到<strong>销毁</strong>呀，这里边还得涉及到一个<strong>销毁顺序</strong>，</p>
<ul>
<li><p>如果我们遇到某个子对象要依赖于其他对象，那么<strong>销毁的顺序</strong>应该和初始化顺序相反。</p>
</li>
<li><p>而对于<strong>字段</strong>，则意味着与声明的顺序相反（因为<strong>字段</strong>的初始化是按照声明的顺序进行的）。</p>
</li>
<li>对于基类，首先应该对其导出类进行清理，然后再是基类。</li>
</ul>
<p>上面的知识点很简单啦，就是很明白浅显的道理——<strong>先进先出</strong>嘛！</p>
<p>对于代码的哈，我再来个图解</p>
<p><img src="https://i.loli.net/2020/04/17/rmxS71Oe8UsAPTR.jpg" alt="清理代码图解.jpg"></p>
<p>帮助大家理解这是怎样一个过程哈</p>
<h3 id="代码理解"><a href="#代码理解" class="headerlink" title="代码理解"></a>代码理解</h3><h4 id="首先"><a href="#首先" class="headerlink" title="首先"></a>首先</h4><p>我主函数代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Frog frog = <span class="keyword">new</span> Frog();</span><br></pre></td></tr></table></figure>
<p>意味着我们开始<strong>Create</strong> <strong>Create</strong> <strong>Create</strong> 了，首先<strong>Frog</strong>中初始化了两个<strong>Characteristic</strong>和<strong>Description</strong>类对象，同时这也是正式开始<strong>Create</strong> <strong>Create</strong> <strong>Create</strong> 了。</p>
<p>具体我们是会先指向最基本的那个基类<strong>LivingCreature</strong>开始<strong>Create</strong>，然后依次往下，最后到<strong>Frog</strong>结束<strong>Create</strong>。</p>
<p>输出结果是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Creating Characteristic is alive</span><br><span class="line">Creating Description Basic Living Creature</span><br><span class="line">LivingCreature()</span><br><span class="line">Creating Characteristic has heart</span><br><span class="line">Creating Description Animal not Vegetable</span><br><span class="line">Animal()</span><br><span class="line">Creating Characteristic can live in water</span><br><span class="line">Creating Description Both water and land</span><br><span class="line">Amphibian</span><br><span class="line">Creating Characteristic Croaks</span><br><span class="line">Creating Description Eats Bugs</span><br><span class="line">Frog()</span><br></pre></td></tr></table></figure>
<h4 id="然后"><a href="#然后" class="headerlink" title="然后"></a>然后</h4><p>我主函数代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">"Bye!"</span>);</span><br></pre></td></tr></table></figure>
<p>暂时小结一下哈！</p>
<p>输出结果是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Bye!</span><br></pre></td></tr></table></figure>
<h4 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h4><p>我主函数代码是这样的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frog.dispose();</span><br></pre></td></tr></table></figure>
<p>这是调用了我<strong>Frog</strong>类中的<strong>dispose()</strong>方法，正式开始<strong>dispose</strong> <strong>dispose</strong> <strong>dispose</strong>了。</p>
<p><strong>dispose</strong>的顺序与之前<strong>Create</strong>的相反。它是先把底层的，最新的那个导出类（子类）先给<strong>dispose</strong>了，依次向上，最后把最终大Boss <strong>LivingCreature</strong>给<strong>dispose</strong>了，很是简单呢！！！只要花点时间看看就能懂的代码呢，以后我就不打算花时间看书看代码了，直接看我的日记不就得了，哈哈哈！</p>
<h2 id="8-3-2-继承与清理-为之前扫扫盲"><a href="#8-3-2-继承与清理-为之前扫扫盲" class="headerlink" title="8.3.2 继承与清理+为之前扫扫盲"></a>8.3.2 继承与清理+为之前扫扫盲</h2><p>为什么说是扫扫盲呢，难道是说我江某人在之前的学习没有努力？不不不，不是这样子的。在编程语言的学习中，我们其实不能够学完所有，得分一步步，慢慢来才能学习完整个语言，但是呢，我们在学习基础的时候，如果要写一些例子，光靠基础知识是不能够的呀，所以我们就会将后边”较<strong>高级</strong>的知识先拿来用，就好比我们的C++中漂漂亮亮的前三行，刚开始不也是想都不想先输上去为敬嘛。</p>
<p>好了，还是赶紧上我们的正餐，上代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mr8god.chaptereight;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> net.mindview.util.Print.print;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shared</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> refcount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> counter = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id = counter++;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Shared</span><span class="params">()</span></span>&#123;</span><br><span class="line">        print(<span class="string">"Creating "</span> + <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addRef</span><span class="params">()</span></span>&#123; refcount++; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispose</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (--refcount == <span class="number">0</span>)&#123;</span><br><span class="line">            print(<span class="string">"Disposing "</span> + <span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Shared&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Composing</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Shared shared;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> counter = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id = counter++;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Composing</span><span class="params">(Shared shared)</span></span>&#123;</span><br><span class="line">        print(<span class="string">"Creating "</span> + <span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">this</span>.shared = shared;</span><br><span class="line">        <span class="keyword">this</span>.shared.addRef();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispose</span><span class="params">()</span></span>&#123;</span><br><span class="line">        print(<span class="string">"disposing "</span> + <span class="keyword">this</span>);</span><br><span class="line">        shared.dispose();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Composing&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/16</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 21:52</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReferenceCounting</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Shared shared = <span class="keyword">new</span> Shared();</span><br><span class="line">        Composing[] composing = &#123; </span><br><span class="line">                <span class="keyword">new</span> Composing(shared),</span><br><span class="line">                <span class="keyword">new</span> Composing(shared),</span><br><span class="line">                <span class="keyword">new</span> Composing(shared),</span><br><span class="line">                <span class="keyword">new</span> Composing(shared),</span><br><span class="line">                <span class="keyword">new</span> Composing(shared)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">for</span> (Composing c :</span><br><span class="line">                composing) &#123;</span><br><span class="line">            c.dispose();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这还是一个关于<strong>继承与清理</strong> 的例子，但是它和上一个不同的地方在于<u>这次的代码中<strong>成员对象</strong>存在<strong>与其他一个或多个对象共享</strong>的情况</u>，问题变得复杂起来了。这次就不能简单地调用<strong>dispose()</strong>就能解决了，必须使用<strong>引用计数</strong>来跟踪仍旧访问着共享对象的对象数量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Creating Shared&#123;id&#x3D;0&#125;</span><br><span class="line">Creating Composing&#123;id&#x3D;0&#125;</span><br><span class="line">Creating Composing&#123;id&#x3D;1&#125;</span><br><span class="line">Creating Composing&#123;id&#x3D;2&#125;</span><br><span class="line">Creating Composing&#123;id&#x3D;3&#125;</span><br><span class="line">Creating Composing&#123;id&#x3D;4&#125;</span><br><span class="line">disposing Composing&#123;id&#x3D;0&#125;</span><br><span class="line">disposing Composing&#123;id&#x3D;1&#125;</span><br><span class="line">disposing Composing&#123;id&#x3D;2&#125;</span><br><span class="line">disposing Composing&#123;id&#x3D;3&#125;</span><br><span class="line">disposing Composing&#123;id&#x3D;4&#125;</span><br><span class="line">Disposing Shared&#123;id&#x3D;0&#125;</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>
<p>这段代码我分三段来讲</p>
<h3 id="第一段"><a href="#第一段" class="headerlink" title="第一段"></a>第一段</h3><p>在看任何代码之前，我们都要注意<strong>static</strong>这个关键字，因为它总是在任何代码执行之前而被执行。这里就有这么一行代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> counter = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<p>主代码中是这一段</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Shared shared = <span class="keyword">new</span> Shared();</span><br></pre></td></tr></table></figure>
<p>这小小的一段代码直接指向了<strong>Shared</strong>这个类，我们先来看看这个类的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shared</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> refcount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> counter = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id = counter++;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Shared</span><span class="params">()</span></span>&#123;</span><br><span class="line">        print(<span class="string">"Creating "</span> + <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addRef</span><span class="params">()</span></span>&#123; refcount++; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispose</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (--refcount == <span class="number">0</span>)&#123;</span><br><span class="line">            print(<span class="string">"Disposing "</span> + <span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Shared&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>开始执行代码了首先它先做了两个变量的初始化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> refcount = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id = counter++;</span><br></pre></td></tr></table></figure>
<p>这边的变量<strong>refcount</strong>是我们在第三段调用<strong>dispose()</strong>时需要用到的，暂时不看。<br>这里的变量<strong>counter</strong>是我们在第二段正式调用<strong>Create()</strong>时需要用到的，暂时不看。</p>
<p>接下来，就是第一段的正事了，代码先跑到了<strong>Shared()</strong>方法里，使用<strong>print</strong>方法（过后真正用到该方法，我会贴源码的），方法里的东西有一个是有趣，就是我们在第四章的老朋友<strong>this</strong>了，这边的<strong>this</strong>指的是我们调用它的对象——主函数中的<strong>shared</strong>，哦了，解释完毕。</p>
<p>看<strong>print</strong>源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.PrintStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Print</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        System.out.println(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printnb</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        System.out.print(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PrintStream <span class="title">printf</span><span class="params">(String format, Object... args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> System.out.printf(format, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是，接下来<strong>print(this)</strong>会干什么呢？<strong>this</strong>相当于一种低级的类，或者说是一种子类。我们可以看到我们的<strong>this</strong>低级类被强转了，或者叫做<strong>向上转型</strong>。成功的称为上流社会<strong>Object</strong>类了。然后理所应当地调用<strong>toString</strong>方法，只不过我们这边重写了这个方法，于是它就按照我们重写的方法执行了，来到了本地的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Shared&#123;"</span> +</span><br><span class="line">            <span class="string">"id="</span> + id +</span><br><span class="line">            <span class="string">'&#125;'</span>;</span><br></pre></td></tr></table></figure>
<p>中去，最终实现了输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Creating Shared&#123;id&#x3D;0&#125;</span><br></pre></td></tr></table></figure>
<p>光荣使命！！！没想到以前的一个小小的输出就要涉及这么多东西呀，害，太难了。理解上面的内容，你还需要在心中明确这样一点<strong>system.out.println()都是直接调用toString打印的</strong>。</p>
<h3 id="第二段"><a href="#第二段" class="headerlink" title="第二段"></a>第二段</h3><p>代码的第二段就是持续的执行我主函数中的<strong>Composing</strong>数组了，里边的五个成员，依次进行初始化。输出结果的原理和第一段一样，</p>
<p>说一下我们先前没有讲的<strong>counter</strong>变量，这个变量的用途就是计数，然后赋值给<strong>id</strong>然后进行输出的时候变得好看一点的操作，over。<strong>counter</strong>会从1变到5，然后赋值给<strong>id</strong>并进行输出</p>
<p>但是我们在此基础上增加了一个<strong>“心眼”</strong>，我们还使用<strong>addRef()</strong>方法。该方法的作用就是使咱们的<strong>refcount</strong>凑效，使其开始赋值，从0到5，然后以备我们第三段代码中被用到。</p>
<p>关于<strong>addRef()</strong>方法，我这边还有点话要说。<br><strong>Composing</strong>类的构造函数和<strong>Shared</strong>类的构造函数出现了一丢丢区别。我们看代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Composing</span><span class="params">(Shared shared)</span></span>&#123;</span><br><span class="line">    print(<span class="string">"Creating "</span> + <span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>.shared = shared;</span><br><span class="line">    <span class="keyword">this</span>.shared.addRef();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这边涉及到我们的<strong>this</strong>知识，是关于我<strong>this</strong>的第二种用法，<strong>在构造器中调用构造器</strong>。方法的具体实现是这样子的，<br>首先，由于没有继承关系，我们在<strong>Composing</strong>中设了一个<strong>Shared</strong>的对象。然后该对象就到了我们的构造方法中了<br>然后，我们可以看到我们在构造方法中，是这样调用<strong>Shared</strong>的<strong>addRef</strong>方法的。我们先把传进来的<strong>Shared</strong>赋值给我们的<strong>this.shared</strong>于是把传进来的<strong>Shared</strong>与之前特意设立的<strong>Shared</strong>通过<strong>this</strong>联系在一起。<br>接下来，我们就这样的使用<strong>引用的引用</strong>最终用我们在主函数中的<strong>shared</strong>对象使用了远在天边近在眼前的<strong>Shared</strong>类中的<strong>addRef()</strong>方法，对，你没有听错，就是这样，这就很<strong>Java</strong>——一步一步调用类中的对象，再用对象调用方法，如果中间有一步因为某些原因断掉了，那就很抱歉，就无法实现目标（调用方法）了。</p>
<p>好啦好啦，当我们运行完所有的第二段代码后，我们会得到一个计数为5的<strong>refcount</strong>变量，以及下面的输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Creating Composing&#123;id&#x3D;0&#125;</span><br><span class="line">Creating Composing&#123;id&#x3D;1&#125;</span><br><span class="line">Creating Composing&#123;id&#x3D;2&#125;</span><br><span class="line">Creating Composing&#123;id&#x3D;3&#125;</span><br><span class="line">Creating Composing&#123;id&#x3D;4&#125;</span><br></pre></td></tr></table></figure>
<h3 id="第三段"><a href="#第三段" class="headerlink" title="第三段"></a>第三段</h3><p>第三段就没啥讲的了，重要的概念理解前两段都讲完了，这边就是单独又引用了一个<strong>dispose</strong>方法。然后输出了，平平无奇！</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>对了，对了，在将一个共享对象附着到类上时，必须记得调用<strong>addRef()</strong>但是<strong>disposing()</strong>将跟踪引用数<strong>refcount</strong>，并决定何时执行清理。使用这种技巧需要加倍地细心，但是如果你正在共享需要清理的对象，那么你就会陷入很麻烦的境地，就更要细心了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mr8god.cn/2020/04/15/Java/Java%E6%B7%B1%E8%80%95/Java%E6%B7%B1%E8%80%95%E2%80%94%E2%80%94%E8%A3%85%E7%AE%B1%E6%8B%86%E7%AE%B1%E6%9C%BA%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mr8god">
      <meta itemprop="description" content="Just learning！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr8god's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/15/Java/Java%E6%B7%B1%E8%80%95/Java%E6%B7%B1%E8%80%95%E2%80%94%E2%80%94%E8%A3%85%E7%AE%B1%E6%8B%86%E7%AE%B1%E6%9C%BA%E5%88%B6/" class="post-title-link" itemprop="url">Java深耕——自动装箱拆箱机制</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-04-15 21:33:29" itemprop="dateCreated datePublished" datetime="2020-04-15T21:33:29+08:00">2020-04-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-16 22:09:39" itemprop="dateModified" datetime="2020-04-16T22:09:39+08:00">2020-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Java深耕——在深入理解Java自动装箱拆箱机制"><a href="#Java深耕——在深入理解Java自动装箱拆箱机制" class="headerlink" title="Java深耕——在深入理解Java自动装箱拆箱机制"></a>Java深耕——在深入理解Java自动装箱拆箱机制</h1><h2 id="自动装箱与拆箱的定义"><a href="#自动装箱与拆箱的定义" class="headerlink" title="自动装箱与拆箱的定义"></a>自动装箱与拆箱的定义</h2><p>装箱就是自动将基本数据类型转换为包装器类型；拆箱就是，自动将包装器类型转换为基本数据类型</p>
<p>Java中的数据类型分为两类：一类是基本数据类型，另一类是引用数据类型</p>
<p><img src="https://i.loli.net/2020/04/15/FseJUGTZ628OwoV.jpg" alt="基本数据类型的分类.jpg"></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">简单类型</th>
<th style="text-align:center">二进制位数</th>
<th style="text-align:center">封装器类</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">int</td>
<td style="text-align:center">32</td>
<td style="text-align:center">Integer</td>
</tr>
<tr>
<td style="text-align:center">byte</td>
<td style="text-align:center">8</td>
<td style="text-align:center">Byte</td>
</tr>
<tr>
<td style="text-align:center">long</td>
<td style="text-align:center">64</td>
<td style="text-align:center">Long</td>
</tr>
<tr>
<td style="text-align:center">float</td>
<td style="text-align:center">32</td>
<td style="text-align:center">Float</td>
</tr>
<tr>
<td style="text-align:center">double</td>
<td style="text-align:center">64</td>
<td style="text-align:center">double</td>
</tr>
<tr>
<td style="text-align:center">char</td>
<td style="text-align:center">16</td>
<td style="text-align:center">Character</td>
</tr>
<tr>
<td style="text-align:center">boolean</td>
<td style="text-align:center">1</td>
<td style="text-align:center">Boolean</td>
</tr>
</tbody>
</table>
</div>
<h2 id="上自动装箱代码"><a href="#上自动装箱代码" class="headerlink" title="上自动装箱代码"></a>上自动装箱代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">int</span> a=<span class="number">3</span>;</span><br><span class="line">        <span class="comment">//定义一个基本数据类型的变量a赋值3</span></span><br><span class="line">        Integer b=a;</span><br><span class="line">        <span class="comment">//b是Integer 类定义的对象，直接用int 类型的a赋值    </span></span><br><span class="line">        System.out.println(b);</span><br><span class="line">        <span class="comment">//打印结果为3</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>上面代码中的Integer b = a;就是我们所说的自动装箱的过程，上面代码在执行的时候调用了Integer.valueOf(int i)方法简化后的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title">valueOf</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;       </span><br><span class="line">        <span class="keyword">if</span> (i &gt;= -<span class="number">128</span> &amp;&amp; i &lt;= <span class="number">127</span>)</span><br><span class="line">            <span class="keyword">return</span> IntegerCache.cache[i + <span class="number">127</span>];</span><br><span class="line">            <span class="comment">//如果i的值大于-128小于127则返回一个缓冲区中的一个Integer对象</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Integer(i);</span><br><span class="line">        <span class="comment">//否则返回 new 一个Integer 对象</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>可以看到Integer.valueOf(a)其实是返回了一个Integer的对象。因此由于自动装箱的存在Integer b = a这段代码是没有问题的，并且我们可以简化的来这样写：Integer b = 3;</p>
<p>同样也等价于这样写：Integer b = Integer.valueOf(3)。</p>
<h2 id="上自动拆箱代码"><a href="#上自动拆箱代码" class="headerlink" title="上自动拆箱代码"></a>上自动拆箱代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line"></span><br><span class="line">        Integer b=<span class="keyword">new</span> Integer(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//b为Integer的对象</span></span><br><span class="line">        <span class="keyword">int</span> a=b;</span><br><span class="line">        <span class="comment">//a为一个int的基本数据类型</span></span><br><span class="line">        System.out.println(a);</span><br><span class="line">        <span class="comment">//打印输出3。</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>上面有一个：int a = b;  代码中把一个对象赋给了基本类型。其实这就等于int a = b.intValue()。</p>
<p>根据源码中可知道intValue是什么</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">intValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这个方法就是返回了value值嘛，但是这里的value又是怎么一回事呢？继续找源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Integer</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>原来这里的value就是，Integer后边括号里的值呀，于是我们的拆箱代码其实本质上是这样写的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line"></span><br><span class="line">        Integer b=<span class="keyword">new</span> Integer(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//b为Integer的对象</span></span><br><span class="line">        <span class="keyword">int</span> a=b.intValue();</span><br><span class="line">        <span class="comment">//其中b.intValue()返回实例化b时构造函数new Integer(3);赋的值3。</span></span><br><span class="line">        System.out.println(a);</span><br><span class="line">        <span class="comment">//打印输出3。</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="范围概念"><a href="#范围概念" class="headerlink" title="范围概念"></a>范围概念</h2><p>这里边是一个挺重要的知识点，至少我之前看的疯狂Java视频资料，以及我看的《Java编程思想》这本书，都有这方面的介绍。先看一个代码哈：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Integer a = <span class="number">1000</span>,b=<span class="number">1000</span>;</span><br><span class="line">		Integer c=<span class="number">100</span>,d=<span class="number">100</span>;</span><br><span class="line">		System.out.println(a==b);</span><br><span class="line">		System.out.println(c==d);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>原本我会以为是输出的是：true    true啦，但是实际上不对，正确答案是false    true。为甚呢？细细道来。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;        </span><br><span class="line">        <span class="comment">//1</span></span><br><span class="line">        Integer a=<span class="keyword">new</span> Integer(<span class="number">123</span>);</span><br><span class="line">        Integer b=<span class="keyword">new</span> Integer(<span class="number">123</span>);</span><br><span class="line">        System.out.println(a==b);<span class="comment">//输出 false</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2 </span></span><br><span class="line">        Integer c=<span class="number">123</span>;</span><br><span class="line">        Integer d=<span class="number">123</span>;  </span><br><span class="line">        System.out.println(c==d);<span class="comment">//输出 true</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//3</span></span><br><span class="line">        Integer e=<span class="number">129</span>;</span><br><span class="line">        Integer f=<span class="number">129</span>;</span><br><span class="line">        System.out.println(e==f);<span class="comment">//输出 false</span></span><br><span class="line">        <span class="comment">//4</span></span><br><span class="line">        <span class="keyword">int</span> g=<span class="number">59</span>;</span><br><span class="line">        Integer h=<span class="keyword">new</span> Integer(<span class="number">59</span>);</span><br><span class="line">        System.out.println(g==h);<span class="comment">//输出 true</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2020/04/15/JAFCoyUKmtDWNn4.jpg" alt="常量池.jpg"></p>
<p>第一部分输出false，很好理解，因为比较的是堆中指向的对象是不是同一个嘛，a,b是栈中对象的引用分别指向堆中的两个不同的对象。而a==b这条语句就是判断a、b在堆中指向的对象是不是统一个，因此输出为false。</p>
<p>第二部分输出true也很好理解，正是用了我们的自动装箱技术</p>
<p>我带大家这次仔细的看自动装箱的源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title">valueOf</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;       </span><br><span class="line">        <span class="keyword">if</span> (i &gt;= -<span class="number">128</span> &amp;&amp; i &lt;= <span class="number">127</span>)</span><br><span class="line">            <span class="keyword">return</span> IntegerCache.cache[i + <span class="number">127</span>];</span><br><span class="line">            <span class="comment">//如果i的值大于-128小于127则返回一个缓冲区中的一个Integer对象</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Integer(i);</span><br><span class="line">        <span class="comment">//否则返回 new 一个Integer 对象</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码中：IntegerCache.cache[i + 127];   表示狠眼生，继续看代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">IntegerCache</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> Integer cache[];</span><br><span class="line">        <span class="comment">//定义一个Integer类型的数组且数组不可变</span></span><br><span class="line">        <span class="keyword">static</span> &#123;  </span><br><span class="line">        <span class="comment">//利用静态代码块对数组进行初始化。                     </span></span><br><span class="line">            cache = <span class="keyword">new</span> Integer[<span class="number">256</span>];</span><br><span class="line">            <span class="keyword">int</span> j = -<span class="number">128</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; cache.length; k++)</span><br><span class="line">                cache[k] = <span class="keyword">new</span> Integer(j++);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//cache[]原来是一个Integer 类型的数组（也可以称为常量池），value 从-128到127，</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title">valueOf</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;   </span><br><span class="line">        <span class="keyword">if</span> (i &gt;=-<span class="number">128</span> &amp;&amp; i &lt;= <span class="number">127</span>)        </span><br><span class="line">            <span class="keyword">return</span> IntegerCache.cache[i + (-IntegerCache.low)];</span><br><span class="line">            <span class="comment">//如果装箱时值在-128到127之间，之间返回常量池中的已经初始化后的Integer对象。</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Integer(i);</span><br><span class="line">        <span class="comment">//否则返回一个新的对象。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>原来IntegerCache类在初始化的时候，生成了一个大小为256的integer类型的常量池，并且integer.val的值从-128~127，当我们运行Integer c = a（临时做的一个小栗子哈）的时候，如果-128 &lt;= a &lt;= 127，就不会再生成新的integer对象。于是我们第二部分的c和d指向的是同一个对象，所以比较的时候是相等的，所以我们输出true。</p>
<p>第三部分，理解如第二部分</p>
<p>第四部分：代码中g指向的是栈中的变量，h指向的是堆中的对象，但是我们的g == h为什么还是true呢？这就是<strong>自动插箱</strong>干的好事，g == h这代码执行的时候就是：g == h.IntValue()，而h.IntValue()=59，所以两边其实是两个int在比较而已。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>简单一句话：</p>
<p><strong>装箱</strong>就是自动将基本数据类型转换为包装器类型；</p>
<p><strong>拆箱</strong>就是自动将包装器类型转换为基本数据类型。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mr8god.cn/2020/04/14/Java/Java%E6%B7%B1%E8%80%95/Java%E6%B7%B1%E8%80%95%E2%80%94%E2%80%94%E7%AC%AC%E5%9B%9B%E7%AB%A0%E4%B9%8Bthis%E5%85%B3%E9%94%AE%E5%AD%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mr8god">
      <meta itemprop="description" content="Just learning！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr8god's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/14/Java/Java%E6%B7%B1%E8%80%95/Java%E6%B7%B1%E8%80%95%E2%80%94%E2%80%94%E7%AC%AC%E5%9B%9B%E7%AB%A0%E4%B9%8Bthis%E5%85%B3%E9%94%AE%E5%AD%97/" class="post-title-link" itemprop="url">Java深耕——第四章之this关键字</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-04-14 15:49:15 / 修改时间：23:15:53" itemprop="dateCreated datePublished" datetime="2020-04-14T15:49:15+08:00">2020-04-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Java深耕——第四章之this关键字"><a href="#Java深耕——第四章之this关键字" class="headerlink" title="Java深耕——第四章之this关键字"></a>Java深耕——第四章之this关键字</h1><p>本文灵感来源于知乎文章（<a href="https://zhuanlan.zhihu.com/p/62779357）" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/62779357）</a><br>以及《Java编程思想》P85页</p>
<h2 id="使用this关键字之前"><a href="#使用this关键字之前" class="headerlink" title="使用this关键字之前"></a>使用this关键字之前</h2><p>Java提供了一个叫做<strong>this</strong>关键字，<strong>this</strong>关键字总是指向调用该方法的对象。根据this出现的位置不同，this作为对象的默认引用有两种情况。</p>
<ol>
<li>构造器中引用该构造器正在初始化的对象</li>
<li>在方法中引用调用该方法的对象</li>
</ol>
<h2 id="在方法中引用调用该方法的对象"><a href="#在方法中引用调用该方法的对象" class="headerlink" title="在方法中引用调用该方法的对象"></a>在方法中引用调用该方法的对象</h2><h3 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h3><p>那我们直接上了概念，肯定是不能够被大家理解的哈，我们转念换个角度来想一想，我们如果没有<strong>this</strong>关键字，会面临一个什么样子的情况呢？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="comment">//定义一个move()方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">move</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"正在执行move()方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//定义一个eat()方法，eat()方法需要借助move()方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Person p = <span class="keyword">new</span> Person();</span><br><span class="line">        p.move();</span><br><span class="line">        System.out.println(<span class="string">"正在执行eat()方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建Person对象</span></span><br><span class="line">        Person p = <span class="keyword">new</span> Person();</span><br><span class="line">        <span class="comment">//调用Person的eat()方法</span></span><br><span class="line">        p.eat();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 代码来源于：https://zhuanlan.zhihu.com/p/62779357</span></span><br></pre></td></tr></table></figure>
<p>运行结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">正在执行move()方法</span><br><span class="line">正在执行eat()方法</span><br></pre></td></tr></table></figure>
<h3 id="代码讲解"><a href="#代码讲解" class="headerlink" title="代码讲解"></a>代码讲解</h3><p>上述的方式确实能够做到eat()方法里调用move()方法，但是我们在main()方法里可以看到我们总共创建了两个对象：main()方法里创建了一个对象；eat()方法里创建了一个对象。但是实际上我们是不需要两个对象的，因为在程序调用第一个eat()方法时一定会提供一个Person对象，而不需要重新创建一个Person了。</p>
<p>因此我们可以通过<strong>this</strong>关键字在eat()方法中获得调用该方法的对象。<strong>this</strong>关键字只能在方法内部使用，表示对”调用方法的那个对象“的引用。</p>
<p>于是上面的代码Person类中的eat()方法改为下面这种方式较为合适：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义一个eat()方法，eat()方法需要借助move()方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//使用this引用调用eat()方法的对象</span></span><br><span class="line">    <span class="keyword">this</span>.move();</span><br><span class="line">    System.out.println(<span class="string">"正在执行eat()方法"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>不过呢，虽然接下来要说的，可能会让读者同学感觉我是在耍你哈。但是可不是哦，上面这么多我只是做个引子而已，用来引导大家的。我先说我要说的知识点吧</p>
<p><strong>this</strong>关键字的用法和其他对象引用并无不同。但是如果要在方法内部调用同一个类的另一个方法，就不必使用this，直接调用即可。当前方法的this引用会自动应用用途同一类中的其他方法。所以上述代码也可以这样写：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义一个eat()方法，eat()方法需要借助move()方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span>&#123;</span><br><span class="line">    move();</span><br><span class="line">    System.out.println(<span class="string">"正在执行eat()方法"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>整体代码可以如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mr8god.example;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/14</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 16:09</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">move</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"正在执行move()方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span>&#123;</span><br><span class="line">        move();</span><br><span class="line">        System.out.println(<span class="string">"正在执行eat()方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Person p = <span class="keyword">new</span> Person();</span><br><span class="line">        p.eat();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>暂时的小总结</strong>：</p>
<p>​        在eat()方法内部，你可以写this.move()，但无此必要。编译器能够帮你自动添加。只有当明确指出对当前对象的引用时，才需要使用<strong>this</strong>关键字。例如，当需要返回对当前对象的引用的时候，就常常在return语句里这样写：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mr8god.chapterfive;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/14</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 11:18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Leaf</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="function">Leaf <span class="title">increment</span><span class="params">()</span></span>&#123;</span><br><span class="line">        i++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"i = "</span> + i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Leaf x = <span class="keyword">new</span> Leaf();</span><br><span class="line">        x.increment().increment().increment().print();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码中，由于increment()通过<strong>this</strong>关键字返回了对当前对象的引用，所以很容易就可以在一条语句里对同一个对象执行多次操作。</p>
<p><strong>this</strong>关键字对于将当前对象传递给其他方法也很有用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mr8god.chapterfive;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/14</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 11:21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">(Apple apple)</span></span>&#123;</span><br><span class="line">        Apple peeled = apple.getPeeled();</span><br><span class="line">        System.out.println(<span class="string">"Yummy"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Peeler</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> Apple <span class="title">peel</span><span class="params">(Apple apple)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> apple;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Apple</span></span>&#123;</span><br><span class="line">    <span class="function">Apple <span class="title">getPeeled</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> Peeler.peel(<span class="keyword">this</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PassingThis</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Person().eat(<span class="keyword">new</span> Apple());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Apple</strong>需要调用<strong>Peeler.peel()</strong>方法，这个方法是一个外部的工具方法，将执行由于某种原因而必须放在<strong>Apple</strong>外部的操作。为了将其自身传递给外部方法，<strong>Apple</strong>必须使用<strong>this</strong>关键字。</p>
<h2 id="在构造器中调用构造器"><a href="#在构造器中调用构造器" class="headerlink" title="在构造器中调用构造器"></a>在构造器中调用构造器</h2><p>另一种情形是：<strong>this</strong>关键字可以用于构造器中作为默认引用，由于构造器是直接使用<strong>new</strong>关键字来调用的，而不是使用对象来调用的，所以<strong>this</strong>在构造器中代表该构造器正在初始化的对象。</p>
<h3 id="例一"><a href="#例一" class="headerlink" title="例一"></a>例一</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mr8god.example;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/14</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 17:05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> age = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">this</span>.age = <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> Person().age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>与普通方法类似，大部分时候，我们在构造器中访问其他成员变量和方法时都可以省略<strong>this</strong>前缀，但是如果构造器中有一个与成员变量同名的局部变量，又必须在构造器中访问这个被覆盖的成员变量，则必须使用<strong>this</strong>前缀。正如上面的程序所示。</p>
<p>当<strong>this</strong>作为对象的默认引用使用时，程序可以像访问普通引用变量一样来访问这个<strong>this</strong>引用，甚至可以把<strong>this</strong>当成普通方法的返回值。如下面的程序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">grow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        age ++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Person p = <span class="keyword">new</span> Person();</span><br><span class="line">        <span class="comment">//可以连续调用同一个方法</span></span><br><span class="line">        p.grow().grow().grow();</span><br><span class="line">        System.out.println(<span class="string">"p对象的age的值是："</span>+p.age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p对象的age的值是：3</span><br></pre></td></tr></table></figure>
<p>上面的代码中可以看到，如果在某个方法中把this作为返回值，则可以多次连续调用同一个方法，从而使得代码变得更加的简洁。</p>
<h3 id="例二"><a href="#例二" class="headerlink" title="例二"></a>例二</h3><p>有时候为一个类写了多个构造器，我们可能想在一个构造器中调用另一个构造器，以避免重复代码。可以使用<strong>this</strong>关键字做到这一点。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mr8god.chapterfive;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> net.mindview.util.Print.print;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr8god</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/14</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 11:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Flower</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> petalCount = <span class="number">0</span>;</span><br><span class="line">    String s = <span class="string">"initial value"</span>;</span><br><span class="line">    Flower(<span class="keyword">int</span> petals)&#123;</span><br><span class="line">        petalCount = petals;</span><br><span class="line">        print(<span class="string">"Constructor w/ int arg only, petalCount= "</span></span><br><span class="line">        + petalCount);</span><br><span class="line">    &#125;</span><br><span class="line">    Flower(String ss)&#123;</span><br><span class="line">        print(<span class="string">"Constructor w/ String arg only, s = "</span> + ss);</span><br><span class="line">        s = ss;</span><br><span class="line">    &#125;</span><br><span class="line">    Flower(String s, <span class="keyword">int</span> petals)&#123;</span><br><span class="line">        <span class="keyword">this</span>(petals);</span><br><span class="line">        <span class="keyword">this</span>.s = s;</span><br><span class="line">        print(<span class="string">"String &amp; int args"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    Flower()&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="string">"hi"</span>, <span class="number">47</span>);</span><br><span class="line">        print(<span class="string">"default constructor (no args)"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printPetalCount</span><span class="params">()</span></span>&#123;</span><br><span class="line">        print(<span class="string">"petalCount = "</span> + petalCount + <span class="string">" s = "</span> + s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Flower x = <span class="keyword">new</span> Flower(<span class="string">"江晨玥"</span>,<span class="number">222</span>);</span><br><span class="line"><span class="comment">//        Flower x = new Flower();</span></span><br><span class="line">        x.printPetalCount();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这串代码如果给初学者看的话，会有一点不明确的地方，毕竟代码太长了嘛，这边给个建议，就只看我们的this指针部分哦！</p>
<p>然后代码中，我选择初始化了一个Flower(“江晨玥”, 222)的方法，首先这行代码会被用到上面的Flower(String s, int petals)里边，很好的实现了方法的重载嘛。然后我们就可以直观地看到这边，我讲解几个可能会有疑问的地方哈</p>
<h4 id="可能会有疑问一"><a href="#可能会有疑问一" class="headerlink" title="可能会有疑问一"></a>可能会有疑问一</h4><p>这边</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Flower(String s, <span class="keyword">int</span> petals)&#123;</span><br><span class="line">        <span class="keyword">this</span>(petals);</span><br><span class="line">        <span class="keyword">this</span>.s = s;</span><br><span class="line">        print(<span class="string">"String &amp; int args"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>代码中的this(petals)到底是怎么一回事，其实有这个疑问还是要算你的<strong>this</strong>关键字没有理解到家，this其实在这里指的是Flower，相当于我在这个Flower(String s, int petals)里引用了Flower(int petals)方法。</p>
<h4 id="可能会有疑问二"><a href="#可能会有疑问二" class="headerlink" title="可能会有疑问二"></a>可能会有疑问二</h4><p>这边的this.s = s，可能也会有疑问，其实这个也展示了this的另外一种用法。由于参数s的名称和数据成员s的名字相同，所以会很容易产生歧义。使用<strong>this.s</strong>就可以来代表数据成员解决这个问题。Java日常编程经常会这样的哦</p>
<h4 id="讲解一"><a href="#讲解一" class="headerlink" title="讲解一"></a>讲解一</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">printPetalCount()</span><br></pre></td></tr></table></figure>
<p>方法表明，除构造器之外，编译器禁止在其他任何方法中调用构造器，不信？你可以试试！</p>
<h2 id="Over！"><a href="#Over！" class="headerlink" title="Over！"></a>Over！</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mr8god.cn/2020/04/12/%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E7%BB%84%E7%BB%87%E7%BB%93%E6%9E%84%E5%9B%BE%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mr8god">
      <meta itemprop="description" content="Just learning！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr8god's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/12/%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E7%BB%84%E7%BB%87%E7%BB%93%E6%9E%84%E5%9B%BE%E8%A7%A3/" class="post-title-link" itemprop="url">博客文章组织结构图解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-04-12 13:21:45 / 修改时间：13:43:17" itemprop="dateCreated datePublished" datetime="2020-04-12T13:21:45+08:00">2020-04-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%BB%BA%E7%AB%99%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/" itemprop="url" rel="index"><span itemprop="name">建站那些事儿</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="本博客文章组织结构图（分类篇）"><a href="#本博客文章组织结构图（分类篇）" class="headerlink" title="本博客文章组织结构图（分类篇）"></a>本博客文章组织结构图（分类篇）</h2><p><img src="https://i.loli.net/2020/04/12/acgHqINPdTx298w.png" alt="Mr8god博客文章组织结构图（分类篇）.png"></p>
<h2 id="本博客文章组织结构图（标签篇）"><a href="#本博客文章组织结构图（标签篇）" class="headerlink" title="本博客文章组织结构图（标签篇）"></a>本博客文章组织结构图（标签篇）</h2><p><img src="https://i.loli.net/2020/04/12/OPf6VKuyH5DLwFU.png" alt="Mr8god博客文章组织结构图（标签篇）.png"></p>
<h2 id="2020年4月12日13-42发布"><a href="#2020年4月12日13-42发布" class="headerlink" title="2020年4月12日13:42发布"></a>2020年4月12日13:42发布</h2><h2 id="未完待续……"><a href="#未完待续……" class="headerlink" title="未完待续……"></a>未完待续……</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Mr8god</p>
  <div class="site-description" itemprop="description">Just learning！</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">47</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">苏 ICP 备 20015778 号 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mr8god</span>
</div>
  <!-- <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>
  -->

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共81.1k字</span>
</div>
        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->




  















  

  

  

</body>
</html>
